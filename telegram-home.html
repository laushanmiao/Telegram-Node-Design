<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            /* Light Mode Colors - From Telegram Screenshots */
            --bg-primary: #FFFFFF;
            --bg-secondary: #F5F5F5;
            --bg-header: #6f8cad;
            --bg-header-rgb: 111, 140, 173;
            --text-primary: #000000;
            --text-secondary: #707579;
            --text-tertiary: #a8a8a8;
            --divider: #EAEAEA;
            --chat-hover: #F5F5F5;
            --unread-bg: #79d171;
            --unread-muted-bg: #b5b5b5;
            --unread-text: #ffffff;
            --message-preview: #707579;
            --time-text: #a8a8a8;
            --icon-color: #ffffff;
            --search-icon: #ffffff;
            --accent-color: #79d171;
        }

        body.night-mode {
            /* Dark Mode Colors - From Telegram Screenshots */
            --bg-primary: #30373d;
            --bg-secondary: #3a4652;
            --bg-header: #3a4652;
            --bg-header-rgb: 58, 70, 82;
            --text-primary: #e4e4ed;
            --text-secondary: #8E8E93;
            --text-tertiary: #707579;
            --divider: #2C2C2E;
            --chat-hover: #3a4652;
            --unread-bg: #accff2;
            --unread-muted-bg: #5e5e5e;
            --unread-text: #ffffff;
            --message-preview: #8E8E93;
            --time-text: #8E8E93;
            --icon-color: #ffffff;
            --search-icon: #ffffff;
            --accent-color: #accff2;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            max-width: 480px;
            margin: 0 auto;
            height: 100dvh;
            overflow: hidden;
            transition: background-color 0.2s ease;
            position: relative;
        }

        /* Header */
        .header {
            background-color: var(--bg-header);
            color: var(--icon-color);
            padding: 12px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 56px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 10;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .menu-icon {
            width: 24px;
            height: 24px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 4px;
            cursor: pointer;
            position: relative;
        }

        .menu-icon::before {
            content: '';
            position: absolute;
            top: -4px;
            right: -4px;
            width: 18px;
            height: 18px;
            background-color: var(--unread-bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
        }

        .menu-icon span {
            display: block;
            width: 100%;
            height: 2px;
            background-color: var(--icon-color);
            border-radius: 1px;
        }

        .header-title {
            font-size: 20px;
            font-weight: 500;
            letter-spacing: 0.15px;
        }

        .search-icon {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }

        .search-icon svg {
            width: 100%;
            height: 100%;
            fill: var(--search-icon);
        }

        /* Chat List */
        .chat-list {
            overflow-y: auto;
            height: calc(100dvh - 56px);
            background-color: var(--bg-primary);
        }

        .chat-item {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            border-bottom: 1px solid var(--divider);
            position: relative;
        }

        .avatar {
            width: 54px;
            height: 54px;
            border-radius: 50%;
            margin-right: 12px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 500;
            color: #ffffff;
            overflow: hidden;
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .chat-content {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .chat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2px;
        }

        .chat-name {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 4px;
            flex: 1;
            min-width: 0;
        }

        .chat-name-text {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .muted-icon {
            width: 16px;
            height: 16px;
            opacity: 0.5;
            flex-shrink: 0;
        }

        .chat-time {
            font-size: 14px;
            color: var(--time-text);
            margin-left: 8px;
            flex-shrink: 0;
        }

        .chat-message {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        .message-preview {
            font-size: 15px;
            color: var(--message-preview);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex: 1;
            min-width: 0;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .message-icon {
            width: 16px;
            height: 16px;
            opacity: 0.6;
            flex-shrink: 0;
        }

        .unread-badge {
            min-width: 22px;
            height: 22px;
            border-radius: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            color: var(--unread-text);
            padding: 0 6px;
            flex-shrink: 0;
        }

        .unread-badge.normal {
            background-color: var(--unread-bg);
        }

        .unread-badge.muted {
            background-color: var(--unread-muted-bg);
        }

        .verified-badge {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
        }

        /* Theme Toggle Button */
        .theme-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background-color: var(--bg-header);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            z-index: 100;
        }

        .theme-toggle:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }

        .theme-toggle:active {
            transform: scale(0.95);
        }

        .theme-toggle svg {
            width: 24px;
            height: 24px;
            fill: var(--icon-color);
        }

        /* Scrollbar Styling */
        .chat-list::-webkit-scrollbar {
            width: 6px;
        }

        .chat-list::-webkit-scrollbar-track {
            background: transparent;
        }

        /* Avatar Colors */
        .avatar-red {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
        }

        .avatar-orange {
            background: linear-gradient(135deg, #ffa94d 0%, #ff922b 100%);
        }

        .avatar-yellow {
            background: linear-gradient(135deg, #ffd43b 0%, #fab005 100%);
        }

        .avatar-green {
            background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%);
        }

        .avatar-cyan {
            background: linear-gradient(135deg, #22b8cf 0%, #15aabf 100%);
        }

        .avatar-blue {
            background: linear-gradient(135deg, #4dabf7 0%, #339af0 100%);
        }

        .avatar-violet {
            background: linear-gradient(135deg, #845ef7 0%, #7048e8 100%);
        }

        .avatar-pink {
            background: linear-gradient(135deg, #f06595 0%, #e64980 100%);
        }

        .avatar-teal {
            background: linear-gradient(135deg, #20c997 0%, #12b886 100%);
        }

        .avatar-purple {
            background: linear-gradient(135deg, #845ef7 0%, #7048e8 100%);
        }

        /* Sidebar / Drawer */
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            z-index: 999;
        }

        .sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 280px;
            height: 100dvh;
            background-color: var(--bg-primary);
            transform: translateX(-100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
        }

        .sidebar.active {
            transform: translateX(0);
        }

        /* Sidebar Top Section */
        .sidebar-top {
            padding: 16px 0;
            border-bottom: 1px solid var(--divider);
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            gap: 16px;
        }

        .sidebar-icon {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar-icon svg {
            width: 24px;
            height: 24px;
            fill: var(--text-secondary);
        }

        .sidebar-label {
            font-size: 16px;
            color: var(--text-primary);
            font-weight: 400;
        }

        /* Sidebar Middle Section - Nodes */
        .sidebar-middle {
            flex: 1;
            overflow-y: auto;
            padding: 16px 0;
        }

        .sidebar-section-title {
            padding: 8px 20px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .node-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            gap: 12px;
        }

        .node-avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 500;
            color: #ffffff;
            flex-shrink: 0;
        }

        .node-info {
            flex: 1;
            min-width: 0;
        }

        .node-name {
            font-size: 16px;
            color: var(--text-primary);
            font-weight: 500;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .node-theme {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 2px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .add-node-button {
            margin: 8px 20px;
            padding: 12px;
            background-color: var(--bg-header);
            border: none;
            border-radius: 8px;
            color: var(--icon-color);
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: opacity 0.15s ease, transform 0.1s ease;
        }

        .add-node-button:hover {
            opacity: 0.9;
        }

        .add-node-button:active {
            transform: scale(0.98);
        }

        .add-node-button svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        /* Sidebar Bottom Section - User Profile */
        .sidebar-bottom {
            padding: 16px 0;
            border-top: 1px solid var(--divider);
        }

        .user-profile {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            gap: 12px;
        }

        .user-avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 500;
            color: #ffffff;
            flex-shrink: 0;
        }

        .user-label {
            font-size: 16px;
            color: var(--text-primary);
            font-weight: 500;
        }

        /* Prevent body scroll when sidebar is open */
        body.sidebar-open {
            overflow: hidden;
        }

        /* Node Interface */
        .node-interface {
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 480px;
            height: 100dvh;
            background-color: var(--bg-primary);
            z-index: 998;
            display: none;
            flex-direction: column;
            overflow: hidden;
            /* Fixed container */
        }

        .node-interface.active {
            display: flex;
        }

        .node-header {
            background-color: var(--bg-header);
            color: var(--icon-color);
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 16px;
            height: 56px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            position: absolute;
            /* Fixed absolute overlay */
            top: 0;
            left: 0;
            width: 100%;
            z-index: 20;
            flex-shrink: 0;
        }

        .back-button {
            width: 24px;
            height: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .back-button svg {
            width: 24px;
            height: 24px;
            fill: var(--icon-color);
        }

        .node-title {
            display: flex;
            flex-direction: column;
            justify-content: center;
            flex: 1;
            line-height: 1.1;
            gap: 0;
        }

        .node-title-line {
            font-size: 16px;
            font-weight: 500;
            letter-spacing: 0.15px;
        }

        /* Identity Header - Fixed part of layout with Gradient Overlay */
        .node-identity-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: linear-gradient(to bottom, var(--bg-header) 0%, rgba(var(--bg-header-rgb), 0) 100%);
            border-bottom: none;
            cursor: pointer;
            position: absolute;
            top: 56px;
            left: 0;
            width: 100%;
            z-index: 10;
            flex-shrink: 0;
        }

        /* Scrollable Content Area */
        .node-scroll-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
            scrollbar-width: thin;
            padding-top: 56px;
            /* Clear fixed Top Header */
        }

        .node-scroll-content::-webkit-scrollbar {
            width: 6px;
        }

        .node-scroll-content::-webkit-scrollbar-thumb {
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 3px;
        }

        /* Remove internal scrolls */
        .node-content-area,
        .tab-content-container,
        .tab-content,
        .chat-list-view,
        .node-content {
            height: auto !important;
            max-height: none !important;
            overflow: visible !important;
            flex: none !important;
        }

        /* Admin Settings Button */
        .admin-settings-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: none;
            cursor: pointer;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s ease;
        }

        .admin-settings-btn:hover {
            background-color: var(--chat-hover);
        }

        .admin-settings-btn svg {
            width: 24px;
            height: 24px;
            fill: var(--icon-color);
        }

        .ai-summary-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            background-color: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 6px 12px;
            color: var(--icon-color);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-right: 8px;
        }

        .ai-summary-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .ai-summary-btn svg {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }

        .node-content {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 56px);
            /* Full height minus header */
        }



        .node-placeholder {
            text-align: center;
            color: var(--text-secondary);
        }

        .node-placeholder-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 16px;
            opacity: 0.3;
        }

        .node-placeholder-icon svg {
            width: 100%;
            height: 100%;
            fill: var(--text-secondary);
        }

        .node-placeholder-text {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .node-placeholder-subtext {
            font-size: 14px;
            color: var(--text-tertiary);
        }

        /* Node Banner Header */
        .node-banner {
            position: relative;
            width: 100%;
            height: 160px;
            /* Reduced to 80% */
            flex-shrink: 0;
            overflow: hidden;
        }

        .node-banner-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .node-banner-gradient {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100%;
            background: linear-gradient(to bottom, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.7) 100%);
        }

        .node-banner-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 16px;
            color: #ffffff;
            z-index: 2;
        }

        .node-banner-name {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 6px;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .node-banner-activity {
            font-size: 14px;
            opacity: 0.95;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .activity-separator {
            opacity: 0.6;
        }

        /* Add Event Button */
        .add-event-btn {
            position: absolute;
            top: 8px;
            right: 16px;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--bg-header);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5;
            transition: transform 0.2s ease, opacity 0.2s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .add-event-btn:hover {
            transform: scale(1.1);
        }

        .add-event-btn svg {
            width: 18px;
            height: 18px;
            fill: #ffffff;
        }

        /* Add Event Modal Styles */
        .event-type-tabs {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .event-type-tab {
            flex: 1 1 0;
            min-width: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 12px 8px;
            border: 2px solid #B0B0B0;
            border-radius: 8px;
            background: none;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 13px;
            font-weight: 500;
            color: #888888;
        }

        .event-type-tab svg {
            width: 24px;
            height: 24px;
            fill: #888888;
        }

        .event-type-tab:hover {
            border-color: #4FC3F7;
            color: #4FC3F7;
        }

        .event-type-tab:hover svg {
            fill: #4FC3F7;
        }

        .event-type-tab.active {
            border-color: #2AABEE;
            background-color: rgba(42, 171, 238, 0.1);
            color: #2AABEE;
        }

        .event-type-tab.active svg {
            fill: #2AABEE;
        }

        /* Dark mode: use dim white for selected tab */
        body.night-mode .event-type-tab.active {
            border-color: rgba(255, 255, 255, 0.7);
            background-color: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.85);
        }

        body.night-mode .event-type-tab.active svg {
            fill: rgba(255, 255, 255, 0.85);
        }

        /* Brighter form labels in dark mode */
        body.night-mode .form-label {
            color: #b0b0b0;
        }

        /* Brighter placeholder text in dark mode */
        body.night-mode .form-input::placeholder,
        body.night-mode .form-textarea::placeholder {
            color: #8a8a8a;
        }

        .poll-option-input {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            align-items: center;
        }

        .poll-option-input .form-input {
            flex: 1;
        }

        .remove-option-btn {
            width: 28px;
            height: 28px;
            border: none;
            background-color: rgba(244, 67, 54, 0.1);
            color: #f44336;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s ease;
        }

        .remove-option-btn:hover {
            background-color: rgba(244, 67, 54, 0.2);
        }

        .add-option-btn {
            width: 100%;
            padding: 10px;
            border: 2px dashed var(--divider);
            border-radius: 8px;
            background: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            margin-top: 4px;
        }

        .add-option-btn:hover {
            border-color: var(--bg-header);
            color: var(--bg-header);
        }

        .event-preview-box {
            padding: 12px;
            background-color: var(--bg-secondary);
            border-radius: 12px;
        }

        /* Banner Carousel */
        .banner-carousel {
            position: relative;
            width: 100%;
            background-color: var(--bg-secondary);
            overflow: hidden;
            flex: 0 0 auto;
            /* Natural height */
        }

        .carousel-container {
            display: flex;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .carousel-container::-webkit-scrollbar {
            display: none;
        }

        .carousel-card {
            min-width: 100%;
            scroll-snap-align: start;
            padding: 8px 16px;
            background-color: var(--bg-secondary);
        }

        .carousel-card-content {
            background-color: var(--bg-primary);
            border-radius: 12px;
            padding: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .carousel-card-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .carousel-card-icon {
            width: 20px;
            height: 20px;
            fill: var(--bg-header);
        }

        .carousel-card-type {
            font-size: 12px;
            font-weight: 600;
            color: var(--bg-header);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .carousel-card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .carousel-card-description {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .poll-options {
            margin-top: 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .poll-option {
            padding: 8px 10px;
            background-color: var(--bg-secondary);
            border-radius: 8px;
            font-size: 14px;
            color: var(--text-primary);
        }

        .meeting-info {
            margin-top: 12px;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .meeting-detail {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .meeting-detail svg {
            width: 16px;
            height: 16px;
            fill: var(--text-secondary);
        }

        .carousel-indicators {
            display: flex;
            justify-content: center;
            gap: 6px;
            padding: 12px 0;
        }

        .carousel-indicator {
            width: 6px;
            height: 6px;
            border-radius: 3px;
            background-color: var(--text-tertiary);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .carousel-indicator.active {
            width: 20px;
            background-color: var(--bg-header);
        }

        /* Content Tabs */
        .node-tabs {
            position: sticky;
            top: 0;
            display: flex;
            align-items: center;
            padding: 0 16px;
            border-bottom: 1px solid var(--divider);
            background-color: var(--bg-primary);
            z-index: 10;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
            flex: 0 0 auto;
            /* Natural height */
        }

        .node-tabs::-webkit-scrollbar {
            display: none;
        }

        .node-tab {
            flex: 1;
            min-width: 80px;
            padding: 14px 16px;
            font-size: 15px;
            font-weight: 500;
            color: var(--text-secondary);
            text-align: center;
            cursor: pointer;
            transition: color 0.2s ease;
            border: none;
            background: none;
            white-space: nowrap;
        }

        .node-tab.active {
            color: var(--bg-header);
        }

        .tab-indicator {
            position: absolute;
            bottom: 0;
            height: 2px;
            background-color: var(--bg-header);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Tab Content */
        .tab-content-container {
            position: relative;
            flex: 1;
            overflow: hidden;
            min-height: 0;
        }

        .tab-content {
            display: none;
            height: 100%;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 16px;
            scroll-behavior: smooth;
        }



        .tab-content.active {
            display: block;
        }

        .tab-content-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-secondary);
            text-align: center;
            padding: 40px 20px;
        }

        .tab-content-icon {
            width: 64px;
            height: 64px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .tab-content-icon svg {
            width: 100%;
            height: 100%;
            fill: var(--text-secondary);
        }

        .tab-content-title {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .tab-content-description {
            font-size: 14px;
            color: var(--text-tertiary);
        }

        /* View Toggle Button */
        .view-toggle {
            position: absolute;
            top: 14px;
            right: 16px;
            display: flex;
            gap: 4px;
            background-color: var(--bg-secondary);
            border-radius: 8px;
            padding: 4px;
            z-index: 10;
        }

        .view-toggle-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: none;
            cursor: pointer;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s ease;
        }

        .view-toggle-btn svg {
            width: 20px;
            height: 20px;
            fill: var(--text-secondary);
        }

        .view-toggle-btn.active {
            background-color: var(--bg-primary);
        }

        .view-toggle-btn.active svg {
            fill: var(--bg-header);
        }

        /* Chat List View */
        .chat-list-view {
            padding: 0;
        }

        .channel-item {
            padding: 10px 12px;
            border-bottom: 1px solid var(--divider);
            position: relative;
        }

        .channel-primary {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 12px;
        }

        .channel-avatar {
            display: none;
            /* Hidden to match Telegram homepage style */
        }

        .channel-info {
            flex: 1;
            min-width: 0;
        }

        .channel-name {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .channel-preview {
            font-size: 14px;
            color: var(--text-secondary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .channel-time {
            font-size: 13px;
            color: var(--time-text);
            flex-shrink: 0;
            margin-top: 2px;
        }

        .channel-nested {
            margin-left: 0;
            padding: 0;
            border-left: none;
        }

        .nested-channel {
            padding: 10px 12px;
            padding-left: 24px;
            border-bottom: 1px solid var(--divider);
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
        }

        .nested-channel-info {
            flex: 1;
            min-width: 0;
        }

        .nested-channel-name {
            font-size: 15px;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .nested-channel-preview {
            font-size: 13px;
            color: var(--text-secondary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Chat Grid View */
        .chat-grid-view,
        .grid-view {
            display: flex;
            flex-direction: column;
            padding: 0;
            /* Padding handled by grid-section */
        }

        .grid-channel-card {
            background-color: var(--bg-secondary);
            border-radius: 12px;
            padding: 12px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-width: 0;
            width: 100%;
        }

        .grid-channel-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .grid-channel-card:active {
            transform: translateY(0);
        }

        .grid-channel-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .grid-channel-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 500;
            color: #ffffff;
        }

        .grid-channel-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex: 1;
        }

        .grid-channel-messages {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .grid-message {
            font-size: 12px;
            color: var(--text-secondary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .grid-message strong {
            color: var(--text-primary);
            font-weight: 500;
        }

        /* Voice Calls Tab */
        .voice-rooms-container {
            padding: 0;
        }

        .voice-section {
            margin-bottom: 24px;
        }

        .voice-section-title {
            padding: 12px 16px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background-color: var(--bg-secondary);
        }

        .voice-room {
            padding: 16px;
            border-bottom: 1px solid var(--divider);
        }

        .voice-room-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .voice-room-name {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            background-color: #ff4444;
            color: #ffffff;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .live-indicator::before {
            content: '';
            width: 6px;
            height: 6px;
            background-color: #ffffff;
            border-radius: 50%;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .scheduled-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            background-color: var(--bg-secondary);
            color: var(--text-secondary);
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .voice-room-participants {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .participant-count {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .participant-count svg {
            width: 16px;
            height: 16px;
            fill: var(--text-secondary);
        }

        .speaking-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            color: #00E676;
            /* Brighter green for dark mode visibility */
        }

        .speaking-indicator svg {
            width: 16px;
            height: 16px;
            fill: #00E676;
            /* Brighter green */
        }

        .voice-room-time {
            font-size: 13px;
            color: var(--text-tertiary);
            margin-top: 4px;
        }

        /* Resources Tab */
        .resources-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .resources-sub-tabs {
            display: flex;
            background-color: var(--bg-primary);
            border-bottom: 1px solid var(--divider);
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .resources-sub-tabs::-webkit-scrollbar {
            display: none;
        }

        .resource-sub-tab {
            flex: 1;
            min-width: 80px;
            padding: 12px 16px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            text-align: center;
            cursor: pointer;
            transition: color 0.2s ease;
            border: none;
            background: none;
            white-space: nowrap;
        }

        .resource-sub-tab.active {
            color: #4FC3F7;
            /* Brighter blue for selected state */
            border-bottom: 2px solid #4FC3F7;
        }

        .resources-content {
            flex: 1;
            overflow-y: auto;
            padding: 0;
        }

        .resource-item {
            padding: 12px 16px;
            border-bottom: 1px solid var(--divider);
        }

        .resource-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .resource-sender {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
        }

        /* Role Colors for Resource Senders */
        .resource-user.admin {
            color: #f44336;
        }

        .resource-user.moderator {
            color: #00E5FF;
        }

        .resource-user.member {
            color: var(--text-secondary);
        }

        .resource-channel {
            font-size: 13px;
            color: var(--bg-header);
            cursor: pointer;
        }

        .resource-channel:hover {
            text-decoration: underline;
        }

        .resource-time {
            font-size: 13px;
            color: var(--text-tertiary);
            margin-left: auto;
        }

        .resource-preview {
            margin-top: 8px;
        }

        .resource-preview-image {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 8px;
        }

        .resource-file-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background-color: var(--bg-secondary);
            border-radius: 8px;
        }

        .resource-file-icon {
            width: 40px;
            height: 40px;
            background-color: var(--bg-header);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .resource-file-icon svg {
            width: 24px;
            height: 24px;
            fill: #ffffff;
        }

        .resource-file-details {
            flex: 1;
            min-width: 0;
        }

        .resource-file-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .resource-file-size {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .resource-link-preview {
            padding: 12px;
            background-color: var(--bg-secondary);
            border-radius: 8px;
            border-left: 3px solid var(--bg-header);
        }

        .resource-link-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .resource-link-url {
            font-size: 13px;
            color: var(--bg-header);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .resource-audio-player {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background-color: var(--bg-secondary);
            border-radius: 8px;
        }

        .audio-play-button {
            width: 40px;
            height: 40px;
            background-color: var(--bg-header);
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.2s ease;
        }

        .audio-play-button:hover {
            opacity: 0.8;
        }

        .audio-play-button svg {
            width: 20px;
            height: 20px;
            fill: #ffffff;
        }

        .audio-info {
            flex: 1;
        }

        .audio-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .audio-duration {
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* User Role Labels */
        .user-role {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-left: 6px;
        }

        .role-admin {
            background-color: rgba(244, 67, 54, 0.15);
            color: #f44336;
        }

        .role-moderator {
            background-color: rgba(81, 125, 162, 0.15);
            color: #40c4ff;
            /* Brighter blue */
        }

        .role-member {
            background-color: rgba(128, 128, 128, 0.15);
            color: var(--text-secondary);
        }

        /* Node Creation Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.6);
            /* Darker overlay */
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.2s ease;
            backdrop-filter: blur(4px);
            /* Blur effect */
        }

        .modal-overlay.active {
            display: flex;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .modal-content {
            background-color: var(--bg-primary);
            border-radius: 16px;
            /* Rounded corners */
            width: 90%;
            max-width: 460px;
            /* Slightly wider */
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            /* Smoother spring */
            transform: scale(1);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        @keyframes slideUp {
            from {
                transform: scale(0.95);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .modal-header {
            padding: 24px 24px 16px;
            /* Spacery header */
            border-bottom: 1px solid var(--divider);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-family: 'Segoe UI', system-ui, sans-serif;
            font-size: 20px;
            font-weight: 700;
            /* Bolder */
            color: var(--text-primary);
        }

        /* Node Identity Header */
        .node-identity-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px;
            background-color: var(--bg-primary);
            border-bottom: 1px solid var(--divider);
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .node-identity-header:hover {
            background-color: var(--chat-hover);
        }

        .identity-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--bg-header);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 500;
            color: #ffffff;
            overflow: hidden;
        }

        .identity-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .identity-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 2px;
        }

        .identity-name {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .identity-role {
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 4px;
            background-color: rgba(64, 196, 255, 0.15);
            /* Bright blue bg */
            color: #40c4ff;
            /* Bright blue text */
            font-weight: 500;
            display: inline-block;
        }

        .edit-indicator {
            width: 20px;
            height: 20px;
            fill: var(--text-tertiary);
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .node-identity-header:hover .edit-indicator {
            opacity: 1;
        }

        /* Live Preview in Modal */
        .live-preview-container {
            margin-top: 24px;
        }

        .live-preview-box {
            padding: 24px;
            background-color: var(--bg-secondary);
            border-radius: 12px;
            /* Matches input radius */
            border: none;
            /* Flat style */
        }

        .preview-label {
            display: block;
            margin-bottom: 10px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .preview-message {
            display: flex;
            align-items: flex-end;
            gap: 8px;
        }

        .preview-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50% !important;
            background-color: var(--bg-header);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #ffffff;
            font-weight: 500;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }

        .preview-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .preview-bubble {
            background-color: var(--bg-primary);
            padding: 12px 16px;
            border-radius: 16px 16px 16px 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            max-width: 85%;
            border: 1px solid var(--divider);
        }

        .preview-header {
            display: flex;
            align-items: baseline;
            gap: 8px;
            margin-bottom: 4px;
        }

        .preview-name {
            font-size: 15px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .preview-role {
            font-size: 11px;
            color: var(--text-tertiary);
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .preview-text {
            font-size: 15px;
            color: var(--text-primary);
            line-height: 1.5;
        }

        /* AI Summary Modal Styles */
        .summary-section {
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--divider);
        }

        .summary-section:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .summary-channel {
            font-weight: 700;
            color: #4FC3F7;
            /* Brighter cyan for channel names */
            margin-bottom: 8px;
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .summary-channel::before {
            content: '#';
            opacity: 0.6;
        }

        .summary-item {
            font-size: 15px;
            line-height: 1.6;
            color: var(--text-primary);
            padding-left: 12px;
            border-left: 3px solid var(--divider);
        }

        /* Collapsible Banner Styles */
        .layout-toggle-container {
            display: flex;
            justify-content: center;
            margin-top: -12px;
            margin-bottom: 8px;
            position: relative;
            z-index: 5;
        }

        .layout-toggle-btn {
            background-color: var(--bg-secondary);
            border: 1px solid var(--divider);
            color: var(--text-secondary);
            border-radius: 12px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .layout-toggle-btn:hover {
            background-color: var(--bg-header);
            transform: translateY(-1px);
        }

        .layout-toggle-btn svg {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }

        /* Collapsed State */
        .header-collapsed .node-banner,
        .header-collapsed .banner-carousel {
            display: none;
        }

        .header-collapsed .layout-toggle-btn svg {
            transform: rotate(180deg);
        }





        .modal-body {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            /* More padding */
        }

        .modal-footer {
            padding: 16px 24px 24px;
            border-top: 1px solid var(--divider);
            display: flex;
            gap: 12px;
            justify-content: space-between;
            /* Allow specific widths */
        }

        .btn {
            border: none;
            cursor: pointer;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.2s;
            flex: 1;
            /* Equal width */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .btn-primary {
            background-color: var(--bg-header);
            color: white;
        }

        .btn-primary:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background-color: transparent;
            color: var(--text-primary);
            border: 1px solid var(--divider);
        }

        .btn-secondary:hover {
            background-color: var(--bg-secondary);
        }

        .form-group {
            margin-bottom: 24px;
            /* More spacing */
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input,
        .form-textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--divider);
            border-radius: 8px;
            font-size: 15px;
            color: var(--text-primary);
            background-color: var(--bg-secondary);
            transition: all 0.2s ease;
        }

        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--bg-header);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
        }

        .char-count {
            font-size: 12px;
            color: var(--text-tertiary);
            text-align: right;
            margin-top: 4px;
        }

        .theme-selector {
            display: flex;
            gap: 12px;
        }

        .theme-option {
            flex: 1;
            padding: 12px;
            border: 2px solid var(--divider);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .theme-option:hover {
            border-color: var(--bg-header);
        }

        .theme-option.selected {
            border-color: #2AABEE;
            background-color: rgba(42, 171, 238, 0.1);
        }

        .theme-color {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin: 0 auto 8px;
        }

        .theme-color.professional {
            background: linear-gradient(135deg, #517da2, #3d5a7a);
        }

        .theme-color.personal {
            background: linear-gradient(135deg, #4caf50, #388e3c);
        }

        .theme-color.recreation {
            background: linear-gradient(135deg, #9c27b0, #7b1fa2);
        }

        .theme-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .banner-upload {
            border: 2px dashed var(--divider);
            border-radius: 8px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .banner-upload:hover {
            border-color: var(--bg-header);
            background-color: var(--bg-secondary);
        }

        .banner-upload-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 12px;
            opacity: 0.5;
        }

        .banner-upload-icon svg {
            width: 100%;
            height: 100%;
            fill: var(--text-secondary);
        }

        .banner-upload-text {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .banner-preview {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
            margin-top: 12px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background-color: var(--bg-header);
            color: #ffffff;
        }

        .btn-primary:hover {
            opacity: 0.9;
        }

        .btn-secondary {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background-color: var(--chat-hover);
        }

        /* Invite Tabs */
        .invite-tabs {
            display: flex;
            border-bottom: 1px solid var(--divider);
            margin-bottom: 20px;
        }

        .invite-tab {
            flex: 1;
            padding: 12px;
            border: none;
            background: none;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            transition: color 0.2s ease;
            border-bottom: 2px solid transparent;
        }

        .invite-tab.active {
            color: #2AABEE;
            border-bottom-color: #2AABEE;
        }

        .invite-content {
            display: none;
        }

        .invite-content.active {
            display: block;
        }

        /* Contact List */
        .contact-search {
            margin-bottom: 16px;
        }

        .contact-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .contact-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
        }

        .contact-checkbox {
            width: 20px;
            height: 20px;
            margin-right: 12px;
        }

        .contact-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 500;
            color: #ffffff;
        }

        .contact-info {
            flex: 1;
        }

        .contact-name {
            font-size: 15px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .contact-username {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .selected-count {
            padding: 8px 16px;
            background-color: var(--bg-secondary);
            border-radius: 8px;
            text-align: center;
            margin-top: 12px;
            font-size: 14px;
            color: var(--text-primary);
        }

        /* QR Code Display */
        .qr-code-container {
            text-align: center;
            padding: 20px;
        }

        .qr-code-display {
            width: 200px;
            height: 200px;
            margin: 0 auto 16px;
            padding: 16px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .qr-code-display img {
            width: 100%;
            height: 100%;
        }

        .qr-instructions {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        /* Invite Link */
        .invite-link-box {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .invite-link-input {
            flex: 1;
            padding: 12px;
            background-color: var(--bg-secondary);
            border: 1px solid var(--divider);
            border-radius: 8px;
            font-size: 14px;
            color: var(--text-primary);
        }

        .copy-btn {
            padding: 12px 20px;
            background-color: var(--bg-header);
            color: #ffffff;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: opacity 0.2s ease;
        }

        .copy-btn:hover {
            opacity: 0.9;
        }

        .copy-btn.copied {
            background-color: #4caf50;
        }

        .link-expiry {
            margin-top: 16px;
        }

        .expiry-options {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .expiry-option {
            flex: 1;
            padding: 8px;
            border: 1px solid var(--divider);
            border-radius: 6px;
            text-align: center;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .expiry-option:hover {
            border-color: var(--bg-header);
        }

        .expiry-option.selected {
            border-color: var(--bg-header);
            background-color: rgba(81, 125, 162, 0.1);
            color: var(--bg-header);
        }

        /* Share Cards */
        .share-card-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .share-card-tab {
            flex: 1;
            padding: 8px;
            border: 1px solid var(--divider);
            border-radius: 6px;
            text-align: center;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .share-card-tab.active {
            border-color: var(--bg-header);
            background-color: rgba(81, 125, 162, 0.1);
            color: var(--bg-header);
        }

        .share-card-preview {
            background-color: var(--bg-secondary);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .share-card-image {
            width: 100%;
            border-radius: 8px;
            background: linear-gradient(135deg, #517da2, #3d5a7a);
            aspect-ratio: 1/1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #ffffff;
            padding: 24px;
            text-align: center;
        }

        .share-card-image.instagram {
            aspect-ratio: 9/16;
        }

        .share-card-node-name {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .share-card-qr {
            width: 120px;
            height: 120px;
            background-color: #ffffff;
            border-radius: 8px;
            margin: 16px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #666;
        }

        .share-card-cta {
            font-size: 16px;
            font-weight: 500;
            margin-top: 12px;
        }

        .share-actions {
            display: flex;
            gap: 8px;
        }

        .share-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: opacity 0.2s ease;
        }

        .share-btn-download {
            background-color: var(--bg-header);
            color: #ffffff;
        }

        .share-btn-share {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
        }

        .share-btn:hover {
            opacity: 0.9;
        }

        /* Member Directory System */
        .member-icon-button {
            position: absolute;
            top: 16px;
            right: 16px;
            background: rgba(255, 255, 255, 0.15);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s ease;
            z-index: 2;
        }

        .member-icon-button:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .member-icon-button svg {
            width: 20px;
            height: 20px;
            fill: #ffffff;
        }

        .member-count-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background-color: var(--bg-header);
            color: #ffffff;
            font-size: 10px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }

        /* Members Panel */
        .members-panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .members-panel-overlay.active {
            display: block;
        }

        .members-panel {
            position: fixed;
            top: 0;
            right: -100%;
            width: 100%;
            max-width: 400px;
            height: 100dvh;
            background-color: var(--bg-primary);
            box-shadow: -2px 0 8px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .members-panel.active {
            right: 0;
        }

        .members-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--divider);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .members-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }



        .members-search {
            padding: 12px 16px;
            border-bottom: 1px solid var(--divider);
        }

        .members-search input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--divider);
            border-radius: 8px;
            font-size: 14px;
            color: var(--text-primary);
            background-color: var(--bg-secondary);
        }

        .members-search input:focus {
            outline: none;
            border-color: var(--bg-header);
        }

        .members-filters {
            padding: 8px 16px;
            border-bottom: 1px solid var(--divider);
            display: flex;
            gap: 8px;
        }

        .filter-btn {
            padding: 6px 12px;
            border: 1px solid var(--divider);
            border-radius: 16px;
            background: none;
            font-size: 13px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-btn:hover {
            background-color: var(--chat-hover);
        }

        .filter-btn.active {
            background-color: var(--bg-header);
            color: #ffffff;
            border-color: var(--bg-header);
        }

        .members-list {
            flex: 1;
            overflow-y: auto;
        }

        .member-section-header {
            padding: 12px 16px 8px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .member-row {
            padding: 10px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid var(--divider);
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .member-row:hover {
            background-color: var(--chat-hover);
        }

        .member-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 500;
            color: #ffffff;
            position: relative;
        }

        .presence-indicator {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid var(--bg-primary);
        }

        .presence-indicator.online {
            background-color: #4caf50;
        }

        .presence-indicator.offline {
            background-color: #9e9e9e;
        }

        .member-info {
            flex: 1;
            min-width: 0;
        }

        .member-name {
            font-size: 15px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .member-role-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .member-role-label.admin {
            color: #f44336;
        }

        .member-role-label.moderator {
            color: #00E5FF;
        }

        /* Profile Sheet */
        .profile-sheet-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 1001;
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .profile-sheet-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .profile-sheet {
            background-color: var(--bg-primary);
            border-radius: 12px;
            width: 90%;
            max-width: 480px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            animation: slideUp 0.3s ease;
        }

        .profile-header {
            padding: 24px;
            text-align: center;
            border-bottom: 1px solid var(--divider);
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: 600;
            color: #ffffff;
        }

        .profile-name {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .profile-role-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .profile-role-badge.admin {
            background-color: rgba(244, 67, 54, 0.1);
            color: #f44336;
        }

        .profile-role-badge.moderator {
            background-color: rgba(0, 229, 255, 0.1);
            color: #00E5FF;
        }

        .profile-role-badge.member {
            background-color: rgba(128, 128, 128, 0.1);
            color: var(--text-secondary);
        }

        .profile-body {
            flex: 1;
            overflow-y: auto;
            padding: 16px 0;
        }

        .profile-section {
            padding: 16px 24px;
            border-bottom: 1px solid var(--divider);
        }

        .profile-section-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .profile-stat-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 14px;
        }

        .profile-stat-label {
            color: var(--text-secondary);
        }

        .profile-stat-value {
            color: var(--text-primary);
            font-weight: 500;
        }

        .profile-channels-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .profile-channel-item {
            padding: 8px 12px;
            background-color: var(--bg-secondary);
            border-radius: 8px;
            font-size: 14px;
            color: var(--text-primary);
            cursor: pointer;
            transition: background-color 0.15s ease;
        }

        .profile-channel-item:hover {
            background-color: var(--chat-hover);
        }

        .profile-channel-item::before {
            content: " ";
            color: var(--bg-header);
            font-weight: bold;
        }

        .profile-content-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .profile-content-item {
            padding: 12px;
            background-color: var(--bg-secondary);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.15s ease;
        }

        .profile-content-item:hover {
            background-color: var(--chat-hover);
        }

        .profile-content-count {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .profile-content-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .profile-actions {
            padding: 16px 24px;
            display: flex;
            gap: 8px;
        }

        .action-button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: opacity 0.2s ease;
        }

        .action-button-primary {
            background-color: var(--bg-header);
            color: #ffffff;
        }

        .action-button-secondary {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
        }

        .action-button:hover {
            opacity: 0.9;
        }

        .admin-controls {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .admin-control-btn {
            flex: 1;
            padding: 8px;
            border: 1px solid var(--divider);
            border-radius: 6px;
            background: none;
            font-size: 13px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .admin-control-btn:hover {
            background-color: var(--chat-hover);
        }

        .admin-control-btn.danger {
            color: #f44336;
            border-color: #f44336;
        }

        .admin-control-btn.danger:hover {
            background-color: rgba(244, 67, 54, 0.1);
        }

        /* Dark Mode Specific Brightness Improvements */
        body.night-mode .carousel-card-icon {
            fill: #8fb3d9;
        }

        body.night-mode .carousel-card-type {
            color: #8fb3d9;
        }

        body.night-mode .carousel-card-title {
            color: #f0f0f0;
        }

        body.night-mode .carousel-card-description {
            color: #c0c0c5;
        }

        body.night-mode .carousel-indicator {
            background-color: #6d7885;
        }

        body.night-mode .carousel-indicator.active {
            background-color: #8fb3d9;
        }

        body.night-mode .node-tab.active {
            color: #8fb3d9;
        }

        body.night-mode .tab-indicator {
            background-color: #8fb3d9;
        }

        body.night-mode .view-toggle-btn.active svg {
            fill: #8fb3d9;
        }

        /* Brighten meeting detail text and icons in dark mode */
        body.night-mode .meeting-detail {
            color: #c8d0d8;
        }

        body.night-mode .meeting-detail svg {
            fill: #c8d0d8;
        }

        /* Brighter role label colors in dark mode */
        body.night-mode .member-role-label.admin {
            color: #A67CCB;
        }

        body.night-mode .member-role-label.moderator {
            color: #5B9BD5;
        }

        /* Brighter resources tab elements in dark mode */
        body.night-mode .resources-tab {
            color: #c8d0d8;
        }

        body.night-mode .resources-tab.active {
            color: #8fb3d9;
        }

        body.night-mode .resource-channel {
            color: #c8d0d8;
        }

        body.night-mode .resource-user-role {
            color: #A67CCB;
        }

        /* Resources tab scrollbar in dark mode */
        body.night-mode .resources-content::-webkit-scrollbar-thumb {
            background: var(--text-tertiary);
        }

        body.night-mode .resources-content::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        /* Shared Utility Classes */
        .clickable-item {
            cursor: pointer;
            transition: background-color 0.15s ease;
        }

        .clickable-item:hover {
            background-color: var(--chat-hover);
        }

        .clickable-item:active {
            background-color: var(--chat-hover);
            opacity: 0.8;
        }

        /* Channel Chat Interface */
        .channel-chat {
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 480px;
            height: 100dvh;
            background-color: var(--bg-primary);
            z-index: 1001;
            display: none;
            flex-direction: column;
        }

        .channel-chat.active {
            display: flex;
        }

        .channel-chat-header {
            background-color: var(--bg-header);
            color: var(--icon-color);
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 16px;
            height: 56px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .channel-chat-back {
            width: 24px;
            height: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .channel-chat-back svg {
            width: 24px;
            height: 24px;
            fill: var(--icon-color);
        }

        .channel-chat-icon {
            width: 36px;
            height: 36px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 600;
            color: var(--icon-color);
        }

        .channel-chat-info {
            flex: 1;
            min-width: 0;
        }

        .channel-chat-name {
            font-size: 18px;
            font-weight: 500;
        }

        .channel-chat-count {
            font-size: 13px;
            opacity: 0.8;
        }

        .channel-chat-menu {
            width: 40px;
            height: 40px;
            border: none;
            background: none;
            cursor: pointer;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s ease;
            position: relative;
        }

        .channel-chat-menu:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .channel-chat-menu svg {
            width: 24px;
            height: 24px;
            fill: var(--icon-color);
        }

        /* Channel Action Dropdown */
        .channel-action-dropdown {
            position: absolute;
            top: 50px;
            right: 8px;
            background-color: var(--bg-primary);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            min-width: 200px;
            display: none;
            flex-direction: column;
            z-index: 1002;
            overflow: hidden;
        }

        .channel-action-dropdown.active {
            display: flex;
        }

        .channel-action-item {
            padding: 12px 16px;
            font-size: 15px;
            color: var(--text-primary);
            cursor: pointer;
            transition: background-color 0.15s ease;
            border: none;
            background: none;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .channel-action-item:hover {
            background-color: var(--chat-hover);
        }

        .channel-action-item.danger {
            color: #ff3b30;
        }

        .channel-action-item.danger:hover {
            background-color: rgba(255, 59, 48, 0.1);
        }

        /* Channel Messages Container */
        .channel-messages {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 16px;
            background-color: var(--bg-primary);
            background-image: url('data:image/svg+xml;utf8,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><rect fill="%23f5f5f5" width="100" height="100"/></svg>');
        }

        body.night-mode .channel-messages {
            background-image: url('data:image/svg+xml;utf8,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><rect fill="%232a2f33" width="100" height="100"/></svg>');
        }

        /* Pinned Message */
        .pinned-message {
            background-color: #e3f2fd;
            padding: 10px 12px;
            margin: -16px -16px 16px -16px;
            display: flex;
            align-items: flex-start;
            gap: 8px;
            border-left: 3px solid #2196f3;
            position: sticky;
            top: -16px;
            z-index: 5;
        }

        body.night-mode .pinned-message {
            background-color: #1a3a52;
        }

        .pinned-message-label {
            font-size: 12px;
            font-weight: 600;
            color: #2196f3;
            margin-bottom: 2px;
        }

        .pinned-message-text {
            font-size: 13px;
            color: var(--text-secondary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex: 1;
        }

        .pinned-message-close {
            width: 20px;
            height: 20px;
            border: none;
            background: none;
            cursor: pointer;
            color: var(--text-secondary);
            font-size: 18px;
            line-height: 1;
        }

        /* Message Bubble */
        .message-bubble {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            align-items: flex-start;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            flex-shrink: 0;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 500;
            color: #ffffff;
        }

        .message-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .message-content {
            flex: 1;
            min-width: 0;
            background-color: #ffffff;
            border-radius: 8px;
            padding: 8px 12px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        body.night-mode .message-content {
            background-color: #3a4652;
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 4px;
        }

        .message-sender {
            font-size: 14px;
            font-weight: 500;
            color: #00bcd4;
            /* Cyan for all senders */
        }

        body.night-mode .message-sender {
            color: #4fc3f7;
            /* Lighter cyan in dark mode */
        }

        .message-role-badge {
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 4px;
            background-color: rgba(0, 0, 0, 0.05);
            color: var(--text-tertiary);
            font-weight: 500;
        }

        body.night-mode .message-role-badge {
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Role-based badge colors matching Resources design */
        .message-role-badge.admin {
            color: #f44336;
            background-color: rgba(244, 67, 54, 0.1);
        }

        .message-role-badge.moderator {
            color: #00E5FF;
            background-color: rgba(0, 229, 255, 0.1);
        }

        .message-role-badge.member {
            color: var(--text-secondary);
            background-color: rgba(0, 0, 0, 0.05);
        }

        body.night-mode .message-role-badge.member {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .message-text {
            font-size: 15px;
            color: var(--text-primary);
            line-height: 1.4;
            word-wrap: break-word;
        }

        .message-time {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-top: 4px;
            text-align: right;
        }

        .message-reactions {
            display: flex;
            gap: 4px;
            margin-top: 6px;
        }

        .message-reaction {
            display: flex;
            align-items: center;
            gap: 2px;
            padding: 2px 6px;
            border-radius: 10px;
            background-color: rgba(0, 0, 0, 0.05);
            font-size: 13px;
        }

        body.night-mode .message-reaction {
            background-color: rgba(255, 255, 255, 0.05);
        }

        /* Grid View Section Styling */
        .grid-section {
            margin-bottom: 24px;
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            column-gap: 16px;
            row-gap: 16px;
            padding: 0 16px;
            box-sizing: border-box;
            /* Left-align grid items - prevent centering */
            justify-items: start;
            align-items: start;
            justify-content: flex-start;
            align-content: flex-start;
            grid-auto-flow: row;
        }

        .grid-section-title {
            grid-column: 1 / -1;
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            padding: 12px 0 8px 0;
            margin-bottom: 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.7;
        }

        /* Admin Menu Dropdown */
        .admin-settings-btn {
            position: relative;
        }

        .admin-menu-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--bg-primary);
            border-radius: 12px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2);
            min-width: 200px;
            z-index: 1000;
            display: none;
            overflow: hidden;
        }

        .admin-menu-dropdown.active {
            display: block;
        }

        .admin-menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            cursor: pointer;
            transition: background-color 0.15s ease;
            font-size: 14px;
            color: var(--text-primary);
        }

        .admin-menu-item:hover {
            background-color: var(--chat-hover);
        }

        .admin-menu-item svg {
            width: 20px;
            height: 20px;
            fill: var(--text-secondary);
        }

        .admin-menu-item.danger {
            color: #f44336;
        }

        .admin-menu-item.danger svg {
            fill: #f44336;
        }

        .admin-menu-divider {
            height: 1px;
            background-color: var(--divider);
            margin: 4px 0;
        }

        /* Message Input */
        .channel-message-input {
            padding: 12px 16px;
            background-color: var(--bg-primary);
            border-top: 1px solid var(--divider);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .message-input-field {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid var(--divider);
            border-radius: 20px;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 15px;
            outline: none;
        }

        .message-input-field::placeholder {
            color: var(--text-tertiary);
        }

        .message-input-btn {
            width: 36px;
            height: 36px;
            border: none;
            background: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s ease;
        }

        .message-input-btn:hover {
            background-color: var(--chat-hover);
        }

        .message-input-btn svg {
            width: 24px;
            height: 24px;
            fill: var(--text-secondary);
        }

        .close-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: none;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s ease;
        }

        .close-btn:hover {
            background-color: var(--chat-hover);
        }

        .close-btn svg {
            width: 24px;
            height: 24px;
            fill: var(--text-secondary);
        }

        /* Consolidated Scrollbar Styles */
        .chat-list::-webkit-scrollbar,
        .node-content::-webkit-scrollbar,
        .tab-content::-webkit-scrollbar,
        .resources-content::-webkit-scrollbar {
            width: 8px;
        }

        .chat-list::-webkit-scrollbar-track,
        .node-content::-webkit-scrollbar-track,
        .tab-content::-webkit-scrollbar-track,
        .resources-content::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        .chat-list::-webkit-scrollbar-thumb,
        .node-content::-webkit-scrollbar-thumb,
        .tab-content::-webkit-scrollbar-thumb,
        .resources-content::-webkit-scrollbar-thumb {
            background: var(--text-tertiary);
            border-radius: 4px;
        }

        .chat-list::-webkit-scrollbar-thumb:hover,
        .node-content::-webkit-scrollbar-thumb:hover,
        .tab-content::-webkit-scrollbar-thumb:hover,
        .resources-content::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        /* Node Identity Header */
        .node-identity-header {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            background: var(--bg-primary);
            border-bottom: 1px solid var(--divider);
            cursor: pointer;
            transition: background-color 0.2s ease;
            gap: 12px;
            position: relative;
        }

        .node-identity-header:hover {
            background: var(--chat-hover);
        }

        .identity-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 600;
            color: white;
            flex-shrink: 0;
        }

        .identity-info {
            flex: 1;
            min-width: 0;
        }

        .identity-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .identity-role {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .identity-edit-btn {
            width: 36px;
            height: 36px;
            border: none;
            background: rgba(var(--bg-header-rgb), 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: all 0.2s ease;
        }

        .node-identity-header:hover .identity-edit-btn {
            opacity: 1;
        }

        .identity-edit-btn:hover {
            background: rgba(var(--bg-header-rgb), 0.2);
        }

        .identity-edit-btn svg {
            width: 18px;
            height: 18px;
            fill: var(--bg-header);
        }

        /* Edit Identity Modal */
        .identity-modal {
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .identity-modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--divider);
        }

        .identity-modal-node {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .identity-avatar-section {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
        }

        .identity-avatar-preview {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: 600;
            color: white;
        }

        .identity-avatar-controls {
            flex: 1;
        }

        .btn-change-avatar {
            padding: 8px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--divider);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-change-avatar:hover {
            background: var(--chat-hover);
            border-color: var(--bg-header);
        }

        .identity-preview-section {
            margin-top: 24px;
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        .identity-preview-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .identity-preview-message {
            display: flex;
            gap: 8px;
            align-items: flex-start;
        }

        .identity-preview-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            color: white;
            flex-shrink: 0;
        }

        .identity-preview-content {
            flex: 1;
        }

        .identity-preview-header {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 4px;
        }

        .identity-preview-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .identity-preview-role {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .identity-preview-text {
            font-size: 14px;
            color: var(--text-primary);
            background: var(--bg-primary);
            padding: 8px 12px;
            border-radius: 8px;
            display: inline-block;
        }
    </style>
</head>

<body>
    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <!-- Top Section -->
        <div class="sidebar-top">
            <div class="sidebar-item clickable-item" id="chatsNav">
                <div class="sidebar-icon">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z" />
                    </svg>
                </div>
                <div class="sidebar-label">Chats</div>
            </div>
        </div>

        <!-- Middle Section - Nodes -->
        <div class="sidebar-middle">
            <div class="sidebar-section-title">Nodes</div>

            <!-- Node 1: Astra Dynamics -->
            <div class="node-item clickable-item" data-node="work">
                <div class="node-avatar avatar-blue">
                    <span>AD</span>
                </div>
                <div class="node-info">
                    <div class="node-name">Astra Dynamics</div>
                    <div class="node-theme">Professional</div>
                </div>
            </div>

            <!-- Node 2: Canon R Series Community -->
            <div class="node-item clickable-item" data-node="hobbies">
                <div class="node-avatar avatar-violet">
                    <span>CR</span>
                </div>
                <div class="node-info">
                    <div class="node-name">Canon R Series Community</div>
                    <div class="node-theme">Recreation</div>
                </div>
            </div>

            <!-- Node 3: Sarah's Family -->
            <div class="node-item clickable-item" data-node="family">
                <div class="node-avatar avatar-green">
                    <span>SF</span>
                </div>
                <div class="node-info">
                    <div class="node-name">Sarah's Family</div>
                    <div class="node-theme">Personal</div>
                </div>
            </div>

            <!-- Add Node Button -->
            <button class="add-node-button" id="addNodeBtn">
                <svg viewBox="0 0 24 24">
                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                </svg>
                <span>Create Node</span>
            </button>
        </div>

        <!-- Bottom Section - User Profile -->
        <div class="sidebar-bottom">
            <div class="user-profile clickable-item" id="userProfile">
                <div class="user-avatar">
                    <span>Y</span>
                </div>
                <div class="user-label">You</div>
            </div>
        </div>
    </div>

    <div class="node-interface" id="nodeInterfaceWork">
        <div class="node-header">
            <div class="menu-icon">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <div class="node-title">
                <span class="node-title-line">Astra</span>
                <span class="node-title-line">Dynamics</span>
            </div>
            <button class="ai-summary-btn" onclick="openAiSummaryModal()">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z" />
                </svg>
                <span>AI Summary</span>
            </button>
            <button class="admin-settings-btn" onclick="toggleAdminMenu(event)" title="Node Settings"><svg
                    viewBox="0 0 24 24">
                    <path
                        d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z" />
                </svg>
                <div class="admin-menu-dropdown" id="adminMenuDropdown">
                    <div class="admin-menu-item" onclick="adminMenuAction('change-avatar')">
                        <svg viewBox="0 0 24 24">
                            <path
                                d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                        </svg>
                        Change Node Avatar
                    </div>
                    <div class="admin-menu-item" onclick="adminMenuAction('change-name')">
                        <svg viewBox="0 0 24 24">
                            <path
                                d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" />
                        </svg>
                        Change Node Name
                    </div>
                    <div class="admin-menu-item" onclick="adminMenuAction('edit-description')">
                        <svg viewBox="0 0 24 24">
                            <path
                                d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z" />
                        </svg>
                        Edit Description
                    </div>
                    <div class="admin-menu-divider"></div>
                    <div class="admin-menu-item" onclick="adminMenuAction('create-channel')">
                        <svg viewBox="0 0 24 24">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                        </svg>
                        Create New Channel
                    </div>
                    <div class="admin-menu-item" onclick="adminMenuAction('manage-roles')">
                        <svg viewBox="0 0 24 24">
                            <path
                                d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z" />
                        </svg>
                        Manage Roles
                    </div>
                    <div class="admin-menu-divider"></div>
                    <div class="admin-menu-item" onclick="adminMenuAction('add-members')">
                        <svg viewBox="0 0 24 24">
                            <path
                                d="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V7H4v3H1v2h3v3h2v-3h3v-2H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                        </svg>
                        Add Members
                    </div>
                    <div class="admin-menu-item" onclick="adminMenuAction('remove-members')">
                        <svg viewBox="0 0 24 24">
                            <path
                                d="M14 8c0-2.21-1.79-4-4-4S6 5.79 6 8s1.79 4 4 4 4-1.79 4-4zm3 2v2h6v-2h-6zM2 18v2h16v-2c0-2.66-5.33-4-8-4s-8 1.34-8 4z" />
                        </svg>
                        Remove Members
                    </div>
                    <div class="admin-menu-divider"></div>
                    <div class="admin-menu-item" onclick="adminMenuAction('share-link')">
                        <svg viewBox="0 0 24 24">
                            <path
                                d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z" />
                        </svg>
                        Generate Share Link
                    </div>
                    <div class="admin-menu-item" onclick="adminMenuAction('qr-code')">
                        <svg viewBox="0 0 24 24">
                            <path
                                d="M3 11h8V3H3v8zm2-6h4v4H5V5zm8-2v8h8V3h-8zm6 6h-4V5h4v4zM3 21h8v-8H3v8zm2-6h4v4H5v-4zm8 6h2v-2h-2v2zm0-8h2v4h4v-4h-2V11h-4v2zm4 4h2v4h-2v-4zm0 0h-2v2h2v-2zm4 0h2v2h-2v-2zm0 4h2v2h-2v-2z" />
                        </svg>
                        Generate QR Code
                    </div>
                    <div class="admin-menu-divider"></div>
                    <div class="admin-menu-item" onclick="adminMenuAction('permissions')">
                        <svg viewBox="0 0 24 24">
                            <path
                                d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z" />
                        </svg>
                        Node Permissions
                    </div>
                    <div class="admin-menu-item" onclick="adminMenuAction('archive')">
                        <svg viewBox="0 0 24 24">
                            <path
                                d="M20.54 5.23l-1.39-1.68C18.88 3.21 18.47 3 18 3H6c-.47 0-.88.21-1.16.55L3.46 5.23C3.17 5.57 3 6.02 3 6.5V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6.5c0-.48-.17-.93-.46-1.27zM12 17.5L6.5 12H10v-2h4v2h3.5L12 17.5zM5.12 5l.81-1h12l.94 1H5.12z" />
                        </svg>
                        Archive Node
                    </div>
                    <div class="admin-menu-divider"></div>
                    <div class="admin-menu-item danger" onclick="adminMenuAction('delete')">
                        <svg viewBox="0 0 24 24">
                            <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" />
                        </svg>
                        Delete Node
                    </div>
                </div>
            </button>
        </div>

        <!-- Node Identity Header -->
        <div class="node-identity-header" onclick="openIdentityModal('work')">
            <div class="identity-avatar" id="headerAvatarWork">
                <span>SC</span>
            </div>
            <div class="identity-info">
                <span class="identity-name" id="headerNameWork">Sarah Chen</span>
                <span class="identity-role" id="headerRoleWork">Project Lead</span>
            </div>
            <svg class="edit-indicator" viewBox="0 0 24 24">
                <path
                    d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" />
            </svg>
        </div>

        <div class="node-scroll-content">

            <!-- Banner Header -->
            <div class="node-banner">
                <img src="https://www.uoe.co.uk/wp-content/uploads/2020/07/shutterstock_1030856419.jpg"
                    alt="Astra Dynamics" class="node-banner-image">
                <div class="node-banner-gradient"></div>
                <div class="node-banner-content">
                    <div class="node-banner-name">Astra Dynamics</div>
                    <div class="node-banner-activity">
                        <span>1,240 Members</span>
                        <span class="activity-separator"></span>
                        <span> 52 Online</span>
                        <span class="activity-separator"></span>
                        <span> 3 in Voice</span>
                    </div>
                </div>
                <button class="member-icon-button" id="workMembersBtn">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z" />
                    </svg>
                    <span class="member-count-badge">24</span>
                </button>
            </div>

            <!-- Banner Carousel -->
            <div class="banner-carousel">
                <!-- Add Event Button (Admin Only) -->
                <button class="add-event-btn" onclick="addEvent()" title="Add Event">
                    <svg viewBox="0 0 24 24">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                    </svg>
                </button>
                <div class="carousel-container" id="carouselWork">
                    <!-- Poll Card -->
                    <div class="carousel-card">
                        <div class="carousel-card-content">
                            <div class="carousel-card-header">
                                <svg class="carousel-card-icon" viewBox="0 0 24 24">
                                    <path
                                        d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z" />
                                </svg>
                                <span class="carousel-card-type">Poll</span>
                            </div>
                            <div class="carousel-card-title">Preferred Meeting Time</div>
                            <div class="carousel-card-description">
                                Vote for the best time for weekly team sync
                            </div>
                            <div class="poll-options">
                                <div class="poll-option">Monday 9:00 AM</div>
                                <div class="poll-option">Wednesday 2:00 PM</div>
                                <div class="poll-option">Friday 10:00 AM</div>
                            </div>
                        </div>
                    </div>

                    <!-- Meeting Card -->
                    <div class="carousel-card">
                        <div class="carousel-card-content">
                            <div class="carousel-card-header">
                                <svg class="carousel-card-icon" viewBox="0 0 24 24">
                                    <path
                                        d="M17 10H7v2h10v-2zm2-7h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z" />
                                </svg>
                                <span class="carousel-card-type">Scheduled Meeting</span>
                            </div>
                            <div class="carousel-card-title">Sprint Review</div>
                            <div class="carousel-card-description">
                                Review completed tasks and plan next sprint
                            </div>
                            <div class="meeting-info">
                                <div class="meeting-detail">
                                    <svg viewBox="0 0 24 24">
                                        <path
                                            d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z" />
                                    </svg>
                                    <span>Friday, Dec 15 at 3:00 PM</span>
                                </div>
                                <div class="meeting-detail">
                                    <svg viewBox="0 0 24 24">
                                        <path
                                            d="M20 4h-1V2h-2v2H7V2H5v2H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H4V9h16v11z" />
                                    </svg>
                                    <span>Join via video call</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Announcement Card -->
                    <div class="carousel-card">
                        <div class="carousel-card-content">
                            <div class="carousel-card-header">
                                <svg class="carousel-card-icon" viewBox="0 0 24 24">
                                    <path
                                        d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" />
                                </svg>
                                <span class="carousel-card-type">Announcement</span>
                            </div>
                            <div class="carousel-card-title">Q4 Planning Meeting</div>
                            <div class="carousel-card-description">
                                All team members are required to attend the quarterly planning session. Please review
                                the
                                attached documents before the meeting.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Carousel Indicators -->
                <div class="carousel-indicators">
                    <div class="carousel-indicator active" data-carousel="work" data-index="0"></div>
                    <div class="carousel-indicator" data-carousel="work" data-index="1"></div>
                    <div class="carousel-indicator" data-carousel="work" data-index="2"></div>
                </div>
            </div>

            <!-- Layout Toggle -->


            <!-- Content Tabs -->
            <div class="node-tabs">
                <button class="node-tab active" data-tab="chat" data-node="work">Channels</button>
                <button class="node-tab" data-tab="voice" data-node="work">Voice Calls</button>
                <button class="node-tab" data-tab="resources" data-node="work">Resources</button>
                <div class="tab-indicator" id="tabIndicatorWork" style="left: 0; width: 33.33%;"></div>
            </div>

            <!-- Tab Content Container -->
            <div class="tab-content-container">
                <div class="tab-content active" id="workTabChat">
                    <!-- View Toggle -->
                    <div class="view-toggle">
                        <button class="view-toggle-btn active" data-view="list" data-node="work">
                            <svg viewBox="0 0 24 24">
                                <path
                                    d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z" />
                            </svg>
                        </button>
                        <button class="view-toggle-btn" data-view="grid" data-node="work">
                            <svg viewBox="0 0 24 24">
                                <path
                                    d="M4 11h5V5H4v6zm0 7h5v-6H4v6zm6 0h5v-6h-5v6zm6 0h5v-6h-5v6zm-6-7h5V5h-5v6zm6-6v6h5V5h-5z" />
                            </svg>
                        </button>
                    </div>

                    <!-- List View -->
                    <div class="chat-list-view" id="workListView">
                        <!-- Primary Channel 1 -->
                        <div class="channel-item clickable-item">
                            <div class="channel-primary">
                                <div class="channel-info">
                                    <div class="channel-name">Project Management</div>
                                    <div class="channel-preview"></div>
                                </div>
                                <div class="channel-time"></div>
                            </div>
                        </div>
                        <div class="nested-channel" onclick="openChannelChat('Sprint Planning', 'work')">
                            <div class="nested-channel-info">
                                <div class="nested-channel-name">Sprint Planning</div>
                                <div class="nested-channel-preview">Rachel Park: Updated the sprint board</div>
                            </div>
                            <div class="channel-time">9:00 AM</div>
                        </div>
                        <div class="nested-channel" onclick="openChannelChat('Daily Standup', 'work')">
                            <div class="nested-channel-info">
                                <div class="nested-channel-name">Daily Standup</div>
                                <div class="nested-channel-preview">Alex Kim: Blocker on API integration</div>
                            </div>
                            <div class="channel-time">9:00 AM</div>
                        </div>

                        <!-- Primary Channel 2 -->
                        <div class="channel-item clickable-item">
                            <div class="channel-primary">
                                <div class="channel-info">
                                    <div class="channel-name">Development</div>
                                    <div class="channel-preview"></div>
                                </div>
                                <div class="channel-time"></div>
                            </div>
                        </div>
                        <div class="nested-channel" onclick="openChannelChat('Frontend', 'work')">
                            <div class="nested-channel-info">
                                <div class="nested-channel-name">Frontend</div>
                                <div class="nested-channel-preview">Emma: New component ready</div>
                            </div>
                            <div class="channel-time">8:50 AM</div>
                        </div>
                        <div class="nested-channel" onclick="openChannelChat('Backend', 'work')">
                            <div class="nested-channel-info">
                                <div class="nested-channel-name">Backend</div>
                                <div class="nested-channel-preview">Tom: Database migration complete</div>
                            </div>
                            <div class="channel-time">Yesterday</div>
                        </div>
                        <div class="nested-channel" onclick="openChannelChat('DevOps', 'work')">
                            <div class="nested-channel-info">
                                <div class="nested-channel-name">DevOps</div>
                                <div class="nested-channel-preview">Lisa: Deployment pipeline updated</div>
                            </div>
                            <div class="channel-time">Yesterday</div>
                        </div>

                    </div>

                    <!-- Grid View -->
                    <div class="chat-grid-view" id="workGridView" style="display: none;">
                        <!-- Project Management Section -->
                        <div class="grid-section">
                            <div class="grid-section-title">Project Management</div>

                            <div class="grid-channel-card" onclick="openChannelChat('Sprint Planning', 'work')">
                                <div class="grid-channel-header">
                                    <div class="grid-channel-name">Sprint Planning</div>
                                </div>
                                <div class="grid-channel-messages">
                                    <div class="grid-message"><strong>Rachel Park:</strong> Updated the sprint board
                                    </div>
                                    <div class="grid-message"><strong>Mike Johnson:</strong> Ready for review</div>
                                    <div class="grid-message"><strong>Alex Kim:</strong> I'll take a look</div>
                                    <div class="grid-message"><strong>Emma Davis:</strong> Approved!</div>
                                    <div class="grid-message"><strong>Tom Wilson:</strong> Thanks everyone!</div>
                                </div>
                            </div>

                            <div class="grid-channel-card" onclick="openChannelChat('Daily Standup', 'work')">
                                <div class="grid-channel-header">
                                    <div class="grid-channel-name">Daily Standup</div>
                                </div>
                                <div class="grid-channel-messages">
                                    <div class="grid-message"><strong>Alex Kim:</strong> Blocker on API integration
                                    </div>
                                    <div class="grid-message"><strong>Rachel Park:</strong> Let me help with that</div>
                                    <div class="grid-message"><strong>Mike Johnson:</strong> I can assist too</div>
                                    <div class="grid-message"><strong>Alex Kim:</strong> Issue resolved, thanks!</div>
                                </div>
                            </div>
                        </div>

                        <!-- Development Section -->
                        <div class="grid-section">
                            <div class="grid-section-title">Development</div>

                            <div class="grid-channel-card" onclick="openChannelChat('Frontend', 'work')">
                                <div class="grid-channel-header">
                                    <div class="grid-channel-name">Frontend</div>
                                </div>
                                <div class="grid-channel-messages">
                                    <div class="grid-message"><strong>Emma Davis:</strong> New component ready</div>
                                    <div class="grid-message"><strong>Tom Wilson:</strong> Looks great!</div>
                                    <div class="grid-message"><strong>Alex Kim:</strong> Passed review</div>
                                    <div class="grid-message"><strong>Rachel Park:</strong> Nice work Emma!</div>
                                    <div class="grid-message"><strong>Emma Davis:</strong> Thanks team!</div>
                                </div>
                            </div>

                            <div class="grid-channel-card" onclick="openChannelChat('Backend', 'work')">
                                <div class="grid-channel-header">
                                    <div class="grid-channel-name">Backend</div>
                                </div>
                                <div class="grid-channel-messages">
                                    <div class="grid-message"><strong>Tom Wilson:</strong> Database migration complete
                                    </div>
                                    <div class="grid-message"><strong>Mike Johnson:</strong> Verified on staging</div>
                                    <div class="grid-message"><strong>Alex Kim:</strong> API endpoints updated</div>
                                    <div class="grid-message"><strong>Tom Wilson:</strong> Ready for production</div>
                                    <div class="grid-message"><strong>Rachel Park:</strong> Good to deploy</div>
                                </div>
                            </div>

                            <div class="grid-channel-card" onclick="openChannelChat('DevOps', 'work')">
                                <div class="grid-channel-header">
                                    <div class="grid-channel-name">DevOps</div>
                                </div>
                                <div class="grid-channel-messages">
                                    <div class="grid-message"><strong>Lisa Chen:</strong> Deployment pipeline updated
                                    </div>
                                    <div class="grid-message"><strong>Mike Johnson:</strong> CI/CD looking good</div>
                                    <div class="grid-message"><strong>Lisa Chen:</strong> Added staging environment
                                    </div>
                                    <div class="grid-message"><strong>Tom Wilson:</strong> Tests passing</div>
                                    <div class="grid-message"><strong>Rachel Park:</strong> Great work Lisa!</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-content" id="workTabVoice">
                    <div class="voice-rooms-container">
                        <!-- Live Rooms Section -->
                        <div class="voice-section">
                            <div class="voice-section-title">Live Now</div>

                            <div class="voice-room clickable-item">
                                <div class="voice-room-header">
                                    <div class="voice-room-name">
                                        Daily Standup
                                        <span class="live-indicator">Live</span>
                                    </div>
                                </div>
                                <div class="voice-room-participants">
                                    <div class="participant-count">
                                        <svg viewBox="0 0 24 24">
                                            <path
                                                d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z" />
                                        </svg>
                                        <span>8 participants</span>
                                    </div>
                                    <div class="speaking-indicator">
                                        <svg viewBox="0 0 24 24">
                                            <path
                                                d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z" />
                                        </svg>
                                        <span>3 speaking</span>
                                    </div>
                                </div>
                            </div>

                            <div class="voice-room clickable-item">
                                <div class="voice-room-header">
                                    <div class="voice-room-name">
                                        Code Review Session
                                        <span class="live-indicator">Live</span>
                                    </div>
                                </div>
                                <div class="voice-room-participants">
                                    <div class="participant-count">
                                        <svg viewBox="0 0 24 24">
                                            <path
                                                d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z" />
                                        </svg>
                                        <span>5 participants</span>
                                    </div>
                                    <div class="speaking-indicator">
                                        <svg viewBox="0 0 24 24">
                                            <path
                                                d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z" />
                                        </svg>
                                        <span>2 speaking</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Scheduled Rooms Section -->
                        <div class="voice-section">
                            <div class="voice-section-title">Scheduled</div>

                            <div class="voice-room clickable-item">
                                <div class="voice-room-header">
                                    <div class="voice-room-name">
                                        Sprint Planning
                                        <span class="scheduled-indicator">Upcoming</span>
                                    </div>
                                </div>
                                <div class="voice-room-participants">
                                    <div class="participant-count">
                                        <svg viewBox="0 0 24 24">
                                            <path
                                                d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z" />
                                        </svg>
                                        <span>12 invited</span>
                                    </div>
                                </div>
                                <div class="voice-room-time">Tomorrow at 2:00 PM</div>
                            </div>

                            <div class="voice-room clickable-item">
                                <div class="voice-room-header">
                                    <div class="voice-room-name">
                                        Team All-Hands
                                        <span class="scheduled-indicator">Upcoming</span>
                                    </div>
                                </div>
                                <div class="voice-room-participants">
                                    <div class="participant-count">
                                        <svg viewBox="0 0 24 24">
                                            <path
                                                d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z" />
                                        </svg>
                                        <span>45 invited</span>
                                    </div>
                                </div>
                                <div class="voice-room-time">Friday at 10:00 AM</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-content" id="workTabResources">
                    <div class="resources-container">
                        <!-- Sub-Tabs -->
                        <div class="resources-sub-tabs">
                            <button class="resource-sub-tab active" data-resource-tab="media"
                                data-node="work">Media</button>
                            <button class="resource-sub-tab" data-resource-tab="files" data-node="work">Files</button>
                            <button class="resource-sub-tab" data-resource-tab="links" data-node="work">Links</button>
                            <button class="resource-sub-tab" data-resource-tab="audios" data-node="work">Audios</button>
                        </div>

                        <!-- Resources Content -->
                        <div class="resources-content">
                            <!-- Media Tab Content -->
                            <div class="resource-tab-content" id="workMediaContent">
                                <div class="resource-item">
                                    <div class="resource-header">
                                        <span class="resource-sender">Sarah<span
                                                class="user-role role-admin">Admin</span></span>
                                        <span></span>
                                        <span class="resource-channel">Project Management</span>
                                        <span class="resource-time">Today, 2:30 PM</span>
                                    </div>
                                    <div class="resource-preview">
                                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTTxk3R2IOzOEae_DHqOcCtBLftaph986r-_w&s"
                                            alt="Sprint board screenshot" class="resource-preview-image">
                                    </div>
                                </div>

                                <div class="resource-item">
                                    <div class="resource-header">
                                        <span class="resource-sender">Mike<span
                                                class="user-role role-moderator">Moderator</span></span>
                                        <span></span>
                                        <span class="resource-channel">Development</span>
                                        <span class="resource-time">Yesterday, 4:15 PM</span>
                                    </div>
                                    <div class="resource-preview">
                                        <img src="https://cdn.prod.website-files.com/67335b6d593f94fe7242baf5/6753101a6c5e0126e350ab11_digital-workplace-1680x840-1.jpeg"
                                            alt="UI mockup" class="resource-preview-image">
                                    </div>
                                </div>

                                <div class="resource-item">
                                    <div class="resource-header">
                                        <span class="resource-sender">Rachel<span
                                                class="user-role role-member">Member</span></span>
                                        <span></span>
                                        <span class="resource-channel">Design</span>
                                        <span class="resource-time">Dec 12, 10:20 AM</span>
                                    </div>
                                    <div class="resource-preview">
                                        <img src="https://cdn.prod.website-files.com/6509fe179d7033a278a05268/65276fb06368425b9e2784e0_Blog-feature-What-is-workplace-experience..png"
                                            alt="Design concept" class="resource-preview-image">
                                    </div>
                                </div>
                            </div>

                            <!-- Files Tab Content -->
                            <div class="resource-tab-content" id="workFilesContent" style="display: none;">
                                <div class="resource-item">
                                    <div class="resource-header">
                                        <span class="resource-sender">John<span
                                                class="user-role role-admin">Admin</span></span>
                                        <span></span>
                                        <span class="resource-channel">Development</span>
                                        <span class="resource-time">Today, 11:45 AM</span>
                                    </div>
                                    <div class="resource-preview">
                                        <div class="resource-file-info">
                                            <div class="resource-file-icon">
                                                <svg viewBox="0 0 24 24">
                                                    <path
                                                        d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z" />
                                                </svg>
                                            </div>
                                            <div class="resource-file-details">
                                                <div class="resource-file-name">API_Documentation_v2.pdf</div>
                                                <div class="resource-file-size">2.4 MB</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="resource-item">
                                    <div class="resource-header">
                                        <span class="resource-sender">Emma<span
                                                class="user-role role-moderator">Moderator</span></span>
                                        <span></span>
                                        <span class="resource-channel">Frontend</span>
                                        <span class="resource-time">Yesterday, 3:20 PM</span>
                                    </div>
                                    <div class="resource-preview">
                                        <div class="resource-file-info">
                                            <div class="resource-file-icon">
                                                <svg viewBox="0 0 24 24">
                                                    <path
                                                        d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z" />
                                                </svg>
                                            </div>
                                            <div class="resource-file-details">
                                                <div class="resource-file-name">component_library.zip</div>
                                                <div class="resource-file-size">15.8 MB</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="resource-item">
                                    <div class="resource-header">
                                        <span class="resource-sender">Tom<span
                                                class="user-role role-member">Member</span></span>
                                        <span></span>
                                        <span class="resource-channel">Backend</span>
                                        <span class="resource-time">Dec 11, 9:30 AM</span>
                                    </div>
                                    <div class="resource-preview">
                                        <div class="resource-file-info">
                                            <div class="resource-file-icon">
                                                <svg viewBox="0 0 24 24">
                                                    <path
                                                        d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z" />
                                                </svg>
                                            </div>
                                            <div class="resource-file-details">
                                                <div class="resource-file-name">database_schema.xlsx</div>
                                                <div class="resource-file-size">856 KB</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Links Tab Content -->
                            <div class="resource-tab-content" id="workLinksContent" style="display: none;">
                                <div class="resource-item clickable-item">
                                    <div class="resource-header">
                                        <span class="resource-sender">Sarah<span
                                                class="user-role role-admin">Admin</span></span>
                                        <span></span>
                                        <span class="resource-channel">Project Management</span>
                                        <span class="resource-time">Today, 1:15 PM</span>
                                    </div>
                                    <div class="resource-preview">
                                        <div class="resource-link-preview">
                                            <div class="resource-link-title">Sprint Planning Board</div>
                                            <div class="resource-link-url">https://jira.company.com/sprint-42</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="resource-item clickable-item">
                                    <div class="resource-header">
                                        <span class="resource-sender">Alex<span
                                                class="user-role role-moderator">Moderator</span></span>
                                        <span></span>
                                        <span class="resource-channel">Development</span>
                                        <span class="resource-time">Yesterday, 5:40 PM</span>
                                    </div>
                                    <div class="resource-preview">
                                        <div class="resource-link-preview">
                                            <div class="resource-link-title">GitHub Pull Request #234</div>
                                            <div class="resource-link-url">https://github.com/company/project/pull/234
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="resource-item clickable-item">
                                    <div class="resource-header">
                                        <span class="resource-sender">Rachel<span
                                                class="user-role role-member">Member</span></span>
                                        <span></span>
                                        <span class="resource-channel">Design</span>
                                        <span class="resource-time">Dec 10, 2:50 PM</span>
                                    </div>
                                    <div class="resource-preview">
                                        <div class="resource-link-preview">
                                            <div class="resource-link-title">Figma Design System</div>
                                            <div class="resource-link-url">https://figma.com/file/abc123/design-system
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Audios Tab Content -->
                            <div class="resource-tab-content" id="workAudiosContent" style="display: none;">
                                <div class="resource-item clickable-item">
                                    <div class="resource-header">
                                        <span class="resource-sender">Mike<span
                                                class="user-role role-admin">Admin</span></span>
                                        <span></span>
                                        <span class="resource-channel">Project Management</span>
                                        <span class="resource-time">Today, 10:00 AM</span>
                                    </div>
                                    <div class="resource-preview">
                                        <div class="resource-audio-player">
                                            <button class="audio-play-button">
                                                <svg viewBox="0 0 24 24">
                                                    <path d="M8 5v14l11-7z" />
                                                </svg>
                                            </button>
                                            <div class="audio-info">
                                                <div class="audio-title">Daily Standup Recording</div>
                                                <div class="audio-duration">12:34</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="resource-item clickable-item">
                                    <div class="resource-header">
                                        <span class="resource-sender">John<span
                                                class="user-role role-moderator">Moderator</span></span>
                                        <span></span>
                                        <span class="resource-channel">Development</span>
                                        <span class="resource-time">Yesterday, 2:30 PM</span>
                                    </div>
                                    <div class="resource-preview">
                                        <div class="resource-audio-player">
                                            <button class="audio-play-button">
                                                <svg viewBox="0 0 24 24">
                                                    <path d="M8 5v14l11-7z" />
                                                </svg>
                                            </button>
                                            <div class="audio-info">
                                                <div class="audio-title">Code Review Discussion</div>
                                                <div class="audio-duration">8:45</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="resource-item clickable-item">
                                    <div class="resource-header">
                                        <span class="resource-sender">Lisa<span
                                                class="user-role role-member">Member</span></span>
                                        <span></span>
                                        <span class="resource-channel">DevOps</span>
                                        <span class="resource-time">Dec 9, 4:15 PM</span>
                                    </div>
                                    <div class="resource-preview">
                                        <div class="resource-audio-player">
                                            <button class="audio-play-button">
                                                <svg viewBox="0 0 24 24">
                                                    <path d="M8 5v14l11-7z" />
                                                </svg>
                                            </button>
                                            <div class="audio-info">
                                                <div class="audio-title">Deployment Walkthrough</div>
                                                <div class="audio-duration">15:20</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="node-interface" id="nodeInterfaceFamily">
        <div class="node-header">
            <div class="menu-icon">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <div class="node-title">
                <span class="node-title-line">Sarah's</span>
                <span class="node-title-line">Family</span>
            </div>
        </div>

        <!-- Node Identity Header -->
        <div class="node-identity-header" onclick="openIdentityModal('family')">
            <div class="identity-avatar" id="headerAvatarFamily">
                <span>S</span>
            </div>
            <div class="identity-info">
                <span class="identity-name" id="headerNameFamily">Sarah</span>
                <span class="identity-role" id="headerRoleFamily">Member</span>
            </div>
            <svg class="edit-indicator" viewBox="0 0 24 24">
                <path
                    d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" />
            </svg>
        </div>

        <div class="node-scroll-content">

            <!-- Banner Header -->
            <div class="node-banner">
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcShfhTkFPu7RGzomkrbQDcBFUKJWp9l8TREyA&s"
                    alt="Sarah's Family" class="node-banner-image">
                <div class="node-banner-gradient"></div>
                <div class="node-banner-content">
                    <div class="node-banner-name">Sarah's Family</div>
                    <div class="node-banner-activity">
                        <span>28 Members</span>
                        <span class="activity-separator"></span>
                        <span> 12 Online</span>
                    </div>
                </div>
            </div>

            <!-- Banner Carousel -->
            <div class="banner-carousel">
                <div class="carousel-container" id="carouselFamily">
                    <div class="carousel-card">
                        <div class="carousel-card-content">
                            <div class="carousel-card-header">
                                <svg class="carousel-card-icon" viewBox="0 0 24 24">
                                    <path
                                        d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" />
                                </svg>
                                <span class="carousel-card-type">Announcement</span>
                            </div>
                            <div class="carousel-card-title">Family Reunion Planning</div>
                            <div class="carousel-card-description">
                                Let's start planning our annual family reunion! Please share your preferred dates and
                                location ideas.
                            </div>
                        </div>
                    </div>

                    <div class="carousel-card">
                        <div class="carousel-card-content">
                            <div class="carousel-card-header">
                                <svg class="carousel-card-icon" viewBox="0 0 24 24">
                                    <path
                                        d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z" />
                                </svg>
                                <span class="carousel-card-type">Shared Photos</span>
                            </div>
                            <div class="carousel-card-title">Holiday Photos 2024</div>
                            <div class="carousel-card-description">
                                Check out the latest photos from our holiday celebration!
                            </div>
                        </div>
                    </div>
                </div>

                <div class="carousel-indicators">
                    <div class="carousel-indicator active" data-carousel="family" data-index="0"></div>
                    <div class="carousel-indicator" data-carousel="family" data-index="1"></div>
                </div>
            </div>

            <!-- Content Tabs -->
            <div class="node-tabs">
                <button class="node-tab active" data-tab="chat" data-node="family">Channels</button>
                <button class="node-tab" data-tab="voice" data-node="family">Voice Calls</button>
                <button class="node-tab" data-tab="resources" data-node="family">Resources</button>
                <div class="tab-indicator" id="tabIndicatorFamily" style="left: 0; width: 33.33%;"></div>
            </div>

            <!-- Tab Content Container -->
            <div class="tab-content-container">
                <div class="tab-content active" id="familyTabChat">
                    <div class="tab-content-placeholder">
                        <div class="tab-content-icon">
                            <svg viewBox="0 0 24 24">
                                <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z" />
                            </svg>
                        </div>
                        <div class="tab-content-title">Chat Messages</div>
                        <div class="tab-content-description">Family group conversations</div>
                    </div>
                </div>
                <div class="tab-content" id="familyTabVoice">
                    <div class="tab-content-placeholder">
                        <div class="tab-content-icon">
                            <svg viewBox="0 0 24 24">
                                <path
                                    d="M17.5 12c0 2.76-2.24 5-5 5s-5-2.24-5-5h-2c0 3.53 2.61 6.43 6 6.92V21h2v-2.08c3.39-.49 6-3.39 6-6.92h-2z M11 5c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1V5z" />
                            </svg>
                        </div>
                        <div class="tab-content-title">Voice Calls</div>
                        <div class="tab-content-description">Family voice chats</div>
                    </div>
                </div>
                <div class="tab-content" id="familyTabResources">
                    <div class="tab-content-placeholder">
                        <div class="tab-content-icon">
                            <svg viewBox="0 0 24 24">
                                <path
                                    d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z" />
                            </svg>
                        </div>
                        <div class="tab-content-title">Shared Resources</div>
                        <div class="tab-content-description">Photos, videos, and memories</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="node-interface" id="nodeInterfaceHobbies">
        <div class="node-header">
            <div class="menu-icon">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <div class="node-title">
                <span class="node-title-line">Canon R Series</span>
                <span class="node-title-line">Community</span>
            </div>
            <button class="ai-summary-btn" onclick="openAiSummaryModal()">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z" />
                </svg>
                <span>AI Summary</span>
            </button>
        </div>

        <!-- Node Identity Header -->
        <div class="node-identity-header" onclick="openIdentityModal('hobbies')">
            <div class="identity-avatar" id="headerAvatarHobbies">
                <span>SC</span>
            </div>
            <div class="identity-info">
                <span class="identity-name" id="headerNameHobbies">Sarah Chen</span>
                <span class="identity-role" id="headerRoleHobbies">Member</span>
            </div>
            <svg class="edit-indicator" viewBox="0 0 24 24">
                <path
                    d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" />
            </svg>
        </div>

        <div class="node-scroll-content">

            <!-- Banner Header -->
            <div class="node-banner">
                <img src="https://cdn-blog.superprof.com/blog_gb/wp-content/uploads/2018/02/photography-equipment.jpg"
                    alt="Canon R Series Community" class="node-banner-image">
                <div class="node-banner-gradient"></div>
                <div class="node-banner-content">
                    <div class="node-banner-name">Canon R Series Community</div>
                    <div class="node-banner-activity">
                        <span>456 Members</span>
                        <span class="activity-separator"></span>
                        <span> 89 Online</span>
                        <span class="activity-separator"></span>
                        <span> 7 in Voice</span>
                    </div>
                </div>
                <button class="member-icon-button" id="hobbiesMembersBtn">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z" />
                    </svg>
                    <span class="member-count-badge">24</span>
                </button>
            </div>

            <!-- Banner Carousel -->
            <div class="banner-carousel">
                <div class="carousel-container" id="carouselHobbies">
                    <div class="carousel-card">
                        <div class="carousel-card-content">
                            <div class="carousel-card-header">
                                <svg class="carousel-card-icon" viewBox="0 0 24 24">
                                    <path
                                        d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z" />
                                </svg>
                                <span class="carousel-card-type">Poll</span>
                            </div>
                            <div class="carousel-card-title">Weekly Photo Challenge</div>
                            <div class="carousel-card-description">
                                Vote for this week's photography theme!
                            </div>
                            <div class="poll-options">
                                <div class="poll-option">Golden Hour Portraits</div>
                                <div class="poll-option">Street Photography</div>
                                <div class="poll-option">Macro Nature</div>
                            </div>
                        </div>
                    </div>

                    <div class="carousel-card">
                        <div class="carousel-card-content">
                            <div class="carousel-card-header">
                                <svg class="carousel-card-icon" viewBox="0 0 24 24">
                                    <path
                                        d="M17 10H7v2h10v-2zm2-7h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z" />
                                </svg>
                                <span class="carousel-card-type">Scheduled Event</span>
                            </div>
                            <div class="carousel-card-title">Monthly Photo Walk</div>
                            <div class="carousel-card-description">
                                Join us for a guided photo walk through the botanical gardens
                            </div>
                            <div class="meeting-info">
                                <div class="meeting-detail">
                                    <svg viewBox="0 0 24 24">
                                        <path
                                            d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z" />
                                    </svg>
                                    <span>Saturday, Dec 16 at 9:00 AM</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="carousel-indicators">
                    <div class="carousel-indicator active" data-carousel="hobbies" data-index="0"></div>
                    <div class="carousel-indicator" data-carousel="hobbies" data-index="1"></div>
                </div>
            </div>

            <!-- Content Tabs -->
            <div class="node-tabs">
                <button class="node-tab active" data-tab="chat" data-node="hobbies">Channels</button>
                <button class="node-tab" data-tab="voice" data-node="hobbies">Voice Calls</button>
                <button class="node-tab" data-tab="resources" data-node="hobbies">Resources</button>
                <div class="tab-indicator" id="tabIndicatorHobbies" style="left: 0; width: 33.33%;"></div>
            </div>

            <!-- Tab Content Container -->
            <div class="tab-content-container">
                <div class="tab-content active" id="hobbiesTabChat">
                    <!-- View Toggle -->
                    <div class="view-toggle">
                        <button class="view-toggle-btn active" data-view="list" data-node="hobbies">
                            <svg viewBox="0 0 24 24">
                                <path
                                    d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z" />
                            </svg>
                        </button>
                        <button class="view-toggle-btn" data-view="grid" data-node="hobbies">
                            <svg viewBox="0 0 24 24">
                                <path
                                    d="M4 11h5V5H4v6zm0 7h5v-6H4v6zm6 0h5v-6h-5v6zm6 0h5v-6h-5v6zm-6-7h5V5h-5v6zm6-6v6h5V5h-5z" />
                            </svg>
                        </button>
                    </div>

                    <!-- List View -->
                    <div class="chat-list-view" id="hobbiesListView">
                        <!-- Primary Channel 1 -->
                        <div class="channel-item clickable-item">
                            <div class="channel-primary">
                                <div class="channel-info">
                                    <div class="channel-name">Photo Critiques</div>
                                    <div class="channel-preview"></div>
                                </div>
                                <div class="channel-time"></div>
                            </div>
                        </div>
                        <div class="nested-channel" onclick="openChannelChat('Landscape Photography', 'hobbies')">
                            <div class="nested-channel-info">
                                <div class="nested-channel-name">Landscape Photography</div>
                                <div class="nested-channel-preview">Mike: Check out this sunset capture</div>
                            </div>
                            <div class="channel-time">9:45 AM</div>
                        </div>
                        <div class="nested-channel" onclick="openChannelChat('Portrait Techniques', 'hobbies')">
                            <div class="nested-channel-info">
                                <div class="nested-channel-name">Portrait Techniques</div>
                                <div class="nested-channel-preview">Emma: Tips for natural light portraits</div>
                            </div>
                            <div class="channel-time">8:32 AM</div>
                        </div>

                        <!-- Primary Channel 2 -->
                        <div class="channel-item clickable-item">
                            <div class="channel-primary">
                                <div class="channel-info">
                                    <div class="channel-name">Gear Discussions</div>
                                    <div class="channel-preview"></div>
                                </div>
                                <div class="channel-time"></div>
                            </div>
                        </div>
                        <div class="nested-channel" onclick="openChannelChat('Camera Bodies', 'hobbies')">
                            <div class="nested-channel-info">
                                <div class="nested-channel-name">Camera Bodies</div>
                                <div class="nested-channel-preview">Alex: R5 vs R6 comparison</div>
                            </div>
                            <div class="channel-time">Yesterday</div>
                        </div>


                    </div>

                    <!-- Grid View -->
                    <div class="grid-view" id="hobbiesGridView" style="display: none;">
                        <!-- Photo Critiques Section -->
                        <div class="grid-section">
                            <div class="grid-section-title">Photo Critiques</div>

                            <div class="grid-channel-card"
                                onclick="openChannelChat('Landscape Photography', 'hobbies')">
                                <div class="grid-channel-header">
                                    <div class="grid-channel-name">Landscape Photography</div>
                                </div>
                                <div class="grid-channel-messages">
                                    <div class="grid-message"><strong>Mike Chen:</strong> Just got back from a sunrise
                                        shoot at the mountains!</div>
                                    <div class="grid-message"><strong>Alex Wong:</strong> Can't wait to see the photos!
                                    </div>
                                    <div class="grid-message"><strong>Sarah Miller:</strong> What settings did you use?
                                    </div>
                                    <div class="grid-message"><strong>Mike Chen:</strong> ISO 100, f/11, 1/125s with
                                        polarizer filter</div>
                                    <div class="grid-message"><strong>Tom Anderson:</strong> Great setup! The polarizer
                                        really helps with sky contrast</div>
                                </div>
                            </div>

                            <div class="grid-channel-card" onclick="openChannelChat('Portrait Techniques', 'hobbies')">
                                <div class="grid-channel-header">
                                    <div class="grid-channel-name">Portrait Techniques</div>
                                </div>
                                <div class="grid-channel-messages">
                                    <div class="grid-message"><strong>Emma:</strong> Tips for natural light portraits
                                    </div>
                                    <div class="grid-message"><strong>Sarah:</strong> Try shooting during golden hour
                                    </div>
                                    <div class="grid-message"><strong>Mike:</strong> Window light is also great indoors
                                    </div>
                                    <div class="grid-message"><strong>Alex:</strong> What about reflectors?</div>
                                    <div class="grid-message"><strong>Emma:</strong> White foam boards work great as DIY
                                        reflectors!</div>
                                </div>
                            </div>
                        </div>

                        <!-- Gear Discussions Section -->
                        <div class="grid-section">
                            <div class="grid-section-title">Gear Discussions</div>

                            <div class="grid-channel-card" onclick="openChannelChat('Camera Bodies', 'hobbies')">
                                <div class="grid-channel-header">
                                    <div class="grid-channel-name">Camera Bodies</div>
                                </div>
                                <div class="grid-channel-messages">
                                    <div class="grid-message"><strong>Mike Chen:</strong> Just got the RF 100-500mm!
                                    </div>
                                    <div class="grid-message"><strong>Alex Wong:</strong> How is it? Worth the price?
                                    </div>
                                    <div class="grid-message"><strong>Mike Chen:</strong> Absolutely! The image
                                        stabilization is incredible</div>
                                    <div class="grid-message"><strong>Tom Anderson:</strong> I've been considering that
                                        lens too</div>
                                    <div class="grid-message"><strong>Sarah Miller:</strong> Can't wait to see your
                                        photos!</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-content" id="hobbiesTabVoice">
                    <div class="voice-rooms-container">
                        <div class="voice-section">
                            <div class="voice-section-title">Live Now</div>
                            <div class="voice-room clickable-item">
                                <div class="voice-room-header">
                                    <div class="voice-room-name">
                                        Golden Hour Shoot
                                        <span class="live-indicator">Live</span>
                                    </div>
                                </div>
                                <div class="voice-room-participants">
                                    <div class="participant-count">
                                        <svg viewBox="0 0 24 24">
                                            <path
                                                d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z" />
                                        </svg>
                                        <span>8 participants</span>
                                    </div>
                                    <div class="speaking-indicator">
                                        <svg viewBox="0 0 24 24">
                                            <path
                                                d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z" />
                                        </svg>
                                        <span>2 speaking</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="voice-section">
                            <div class="voice-section-title">Scheduled</div>
                            <div class="voice-room clickable-item">
                                <div class="voice-room-header">
                                    <div class="voice-room-name">
                                        Portfolio Review
                                        <span class="scheduled-indicator">Upcoming</span>
                                    </div>
                                </div>
                                <div class="voice-room-time">Sunday at 3:00 PM</div>
                                <div class="voice-room-participants">
                                    <div class="participant-count">
                                        <svg viewBox="0 0 24 24">
                                            <path
                                                d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z" />
                                        </svg>
                                        <span>15 invited</span>
                                    </div>
                                </div>
                            </div>

                            <div class="voice-room clickable-item">
                                <div class="voice-room-header">
                                    <div class="voice-room-name">
                                        Weekend Photo Walk
                                        <span class="scheduled-indicator">Upcoming</span>
                                    </div>
                                </div>
                                <div class="voice-room-time">Saturday at 9:00 AM</div>
                                <div class="voice-room-participants">
                                    <div class="participant-count">
                                        <svg viewBox="0 0 24 24">
                                            <path
                                                d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z" />
                                        </svg>
                                        <span>22 invited</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-content" id="hobbiesTabResources">
                    <div class="resources-container">
                        <div class="resources-sub-tabs">
                            <button class="resource-sub-tab active" data-resource-tab="media"
                                data-node="hobbies">Media</button>
                            <button class="resource-sub-tab" data-resource-tab="files"
                                data-node="hobbies">Files</button>
                            <button class="resource-sub-tab" data-resource-tab="links"
                                data-node="hobbies">Links</button>
                            <button class="resource-sub-tab" data-resource-tab="audios"
                                data-node="hobbies">Audios</button>
                        </div>

                        <!-- Resources Content -->
                        <div class="resources-content">
                            <!-- Media Tab Content -->
                            <div class="resource-tab-content" id="hobbiesMediaContent">
                                <div class="resource-item">
                                    <div class="resource-header">
                                        <span class="resource-sender">Mike Chen<span
                                                class="user-role role-admin">Admin</span></span>
                                        <span></span>
                                        <span class="resource-channel">Landscape Photography</span>
                                        <span class="resource-time">Today, 8:30 AM</span>
                                    </div>
                                    <div class="resource-preview">
                                        <img src="https://res.cloudinary.com/jerrick/image/upload/v1680894946/64306be1d68222001dc5379b.jpg"
                                            alt="Mountain landscape" class="resource-preview-image">
                                    </div>
                                </div>

                                <div class="resource-item">
                                    <div class="resource-header">
                                        <span class="resource-sender">Sarah Miller<span
                                                class="user-role role-member">Member</span></span>
                                        <span></span>
                                        <span class="resource-channel">Photo Critiques</span>
                                        <span class="resource-time">Yesterday, 5:45 PM</span>
                                    </div>
                                    <div class="resource-preview">
                                        <img src="https://img.freepik.com/free-photo/sunset-time-tropical-beach-sea-with-coconut-palm-tree_74190-1075.jpg?semt=ais_hybrid&w=740&q=80"
                                            alt="Sunset beach" class="resource-preview-image">
                                    </div>
                                </div>

                                <div class="resource-item">
                                    <div class="resource-header">
                                        <span class="resource-sender">Alex Wong<span
                                                class="user-role role-moderator">Moderator</span></span>
                                        <span></span>
                                        <span class="resource-channel">Portrait Techniques</span>
                                        <span class="resource-time">Dec 14, 2:15 PM</span>
                                    </div>
                                    <div class="resource-preview">
                                        <img src="https://platform.vox.com/wp-content/uploads/sites/2/chorus/uploads/chorus_asset/file/19397812/1048232144.jpg.jpg?quality=90&strip=all&crop=0%2C10.736513278159%2C100%2C78.526973443682&w=1200"
                                            alt="Portrait photo" class="resource-preview-image">
                                    </div>
                                </div>
                            </div>

                            <!-- Files Tab Content -->
                            <div class="resource-tab-content" id="hobbiesFilesContent" style="display: none;">
                                <div class="resource-item">
                                    <div class="resource-header">
                                        <span class="resource-sender">Tom Anderson<span
                                                class="user-role role-admin">Admin</span></span>
                                        <span></span>
                                        <span class="resource-channel">Gear Discussions</span>
                                        <span class="resource-time">Today, 9:15 AM</span>
                                    </div>
                                    <div class="resource-preview">
                                        <div class="resource-file-info">
                                            <div class="resource-file-icon">
                                                <svg viewBox="0 0 24 24">
                                                    <path
                                                        d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z" />
                                                </svg>
                                            </div>
                                            <div class="resource-file-details">
                                                <div class="resource-file-name">lightroom_presets_pack.zip</div>
                                                <div class="resource-file-size">15.3 MB</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="resource-item">
                                    <div class="resource-header">
                                        <span class="resource-sender">Emma Torres<span
                                                class="user-role role-moderator">Moderator</span></span>
                                        <span></span>
                                        <span class="resource-channel">Portrait Techniques</span>
                                        <span class="resource-time">Yesterday, 3:20 PM</span>
                                    </div>
                                    <div class="resource-preview">
                                        <div class="resource-file-info">
                                            <div class="resource-file-icon">
                                                <svg viewBox="0 0 24 24">
                                                    <path
                                                        d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z" />
                                                </svg>
                                            </div>
                                            <div class="resource-file-details">
                                                <div class="resource-file-name">camera_settings_guide.pdf</div>
                                                <div class="resource-file-size">2.1 MB</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="resource-item">
                                    <div class="resource-header">
                                        <span class="resource-sender">Mike Chen<span
                                                class="user-role role-admin">Admin</span></span>
                                        <span></span>
                                        <span class="resource-channel">Camera Bodies</span>
                                        <span class="resource-time">Dec 12, 11:30 AM</span>
                                    </div>
                                    <div class="resource-preview">
                                        <div class="resource-file-info">
                                            <div class="resource-file-icon">
                                                <svg viewBox="0 0 24 24">
                                                    <path
                                                        d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z" />
                                                </svg>
                                            </div>
                                            <div class="resource-file-details">
                                                <div class="resource-file-name">RF_lens_comparison.xlsx</div>
                                                <div class="resource-file-size">856 KB</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Links Tab Content -->
                            <div class="resource-tab-content" id="hobbiesLinksContent" style="display: none;">
                                <div class="resource-item clickable-item">
                                    <div class="resource-header">
                                        <span class="resource-sender">Sarah Miller<span
                                                class="user-role role-member">Member</span></span>
                                        <span></span>
                                        <span class="resource-channel">Landscape Photography</span>
                                        <span class="resource-time">Today, 10:45 AM</span>
                                    </div>
                                    <div class="resource-preview">
                                        <div class="resource-link-preview">
                                            <div class="resource-link-title">Best Landscape Photo Locations Guide</div>
                                            <div class="resource-link-url">
                                                https://photographylife.com/landscape-locations</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="resource-item clickable-item">
                                    <div class="resource-header">
                                        <span class="resource-sender">Alex Wong<span
                                                class="user-role role-moderator">Moderator</span></span>
                                        <span></span>
                                        <span class="resource-channel">Gear Discussions</span>
                                        <span class="resource-time">Yesterday, 4:30 PM</span>
                                    </div>
                                    <div class="resource-preview">
                                        <div class="resource-link-preview">
                                            <div class="resource-link-title">Canon RF Lens Comparison Chart</div>
                                            <div class="resource-link-url">https://www.canon.com/rf-lenses/comparison
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="resource-item clickable-item">
                                    <div class="resource-header">
                                        <span class="resource-sender">Tom Anderson<span
                                                class="user-role role-admin">Admin</span></span>
                                        <span></span>
                                        <span class="resource-channel">Photo Critiques</span>
                                        <span class="resource-time">Dec 13, 1:20 PM</span>
                                    </div>
                                    <div class="resource-preview">
                                        <div class="resource-link-preview">
                                            <div class="resource-link-title">Photo Critique Guidelines</div>
                                            <div class="resource-link-url">
                                                https://community.canon.com/critique-guidelines</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Audios Tab Content -->
                            <div class="resource-tab-content" id="hobbiesAudiosContent" style="display: none;">
                                <div class="resource-item clickable-item">
                                    <div class="resource-header">
                                        <span class="resource-sender">Mike Chen<span
                                                class="user-role role-admin">Admin</span></span>
                                        <span></span>
                                        <span class="resource-channel">Landscape Photography</span>
                                        <span class="resource-time">Today, 7:00 AM</span>
                                    </div>
                                    <div class="resource-preview">
                                        <div class="resource-audio-player">
                                            <button class="audio-play-button">
                                                <svg viewBox="0 0 24 24">
                                                    <path d="M8 5v14l11-7z" />
                                                </svg>
                                            </button>
                                            <div class="audio-info">
                                                <div class="audio-title">Sunrise Shoot Planning</div>
                                                <div class="audio-duration">8:45</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="resource-item clickable-item">
                                    <div class="resource-header">
                                        <span class="resource-sender">Emma Torres<span
                                                class="user-role role-moderator">Moderator</span></span>
                                        <span></span>
                                        <span class="resource-channel">Portrait Techniques</span>
                                        <span class="resource-time">Yesterday, 6:15 PM</span>
                                    </div>
                                    <div class="resource-preview">
                                        <div class="resource-audio-player">
                                            <button class="audio-play-button">
                                                <svg viewBox="0 0 24 24">
                                                    <path d="M8 5v14l11-7z" />
                                                </svg>
                                            </button>
                                            <div class="audio-info">
                                                <div class="audio-title">Portfolio Review Session</div>
                                                <div class="audio-duration">45:32</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="resource-item clickable-item">
                                    <div class="resource-header">
                                        <span class="resource-sender">Sarah Miller<span
                                                class="user-role role-member">Member</span></span>
                                        <span></span>
                                        <span class="resource-channel">Gear Discussions</span>
                                        <span class="resource-time">Dec 11, 2:00 PM</span>
                                    </div>
                                    <div class="resource-preview">
                                        <div class="resource-audio-player">
                                            <button class="audio-play-button">
                                                <svg viewBox="0 0 24 24">
                                                    <path d="M8 5v14l11-7z" />
                                                </svg>
                                            </button>
                                            <div class="audio-info">
                                                <div class="audio-title">RF 100-500mm First Impressions</div>
                                                <div class="audio-duration">12:18</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <div class="header">
        <div class="header-left">
            <div class="menu-icon">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <div class="header-title">Telegram</div>
        </div>
        <div class="search-icon">
            <svg viewBox="0 0 24 24">
                <path
                    d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" />
            </svg>
        </div>
    </div>

    <!-- Chat List -->
    <div class="chat-list">
        <!-- Chat 1 -->
        <div class="chat-item clickable-item">
            <div class="avatar avatar-blue">
                <span>D</span>
            </div>
            <div class="chat-content">
                <div class="chat-header">
                    <div class="chat-name">
                        <span class="chat-name-text">Dad</span>
                    </div>
                    <div class="chat-time">10:04 PM</div>
                </div>
                <div class="chat-message">
                    <div class="message-preview">
                        Don't forget to pick up groceries tomorrow
                    </div>
                    <div class="unread-badge normal">3</div>
                </div>
            </div>
        </div>

        <!-- Chat 2 -->
        <div class="chat-item clickable-item">
            <div class="avatar avatar-pink">
                <span>M</span>
            </div>
            <div class="chat-content">
                <div class="chat-header">
                    <div class="chat-name">
                        <span class="chat-name-text">Mum</span>
                    </div>
                    <div class="chat-time">9:59 PM</div>
                </div>
                <div class="chat-message">
                    <div class="message-preview">
                        <svg class="message-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
                        </svg>
                        Thanks for calling earlier! Love you
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat 3 -->
        <div class="chat-item clickable-item">
            <div class="avatar avatar-green">
                <span>SF</span>
            </div>
            <div class="chat-content">
                <div class="chat-header">
                    <div class="chat-name">
                        <span class="chat-name-text">Sam's Family</span>
                        <svg class="muted-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z" />
                        </svg>
                    </div>
                    <div class="chat-time">9:10 PM</div>
                </div>
                <div class="chat-message">
                    <div class="message-preview">
                        Sam: Are we still meeting this weekend?
                    </div>
                    <div class="unread-badge muted">1</div>
                </div>
            </div>
        </div>

        <!-- Chat 4 -->
        <div class="chat-item clickable-item">
            <div class="avatar avatar-orange">
                <span>WU</span>
            </div>
            <div class="chat-content">
                <div class="chat-header">
                    <div class="chat-name">
                        <span class="chat-name-text">Work Updates</span>
                    </div>
                    <div class="chat-time">8:37 PM</div>
                </div>
                <div class="chat-message">
                    <div class="message-preview">
                        Meeting rescheduled to 3 PM tomorrow
                    </div>
                    <div class="unread-badge normal">2</div>
                </div>
            </div>
        </div>

        <!-- Chat 5 -->
        <div class="chat-item clickable-item">
            <div class="avatar avatar-violet">
                <span>SG</span>
            </div>
            <div class="chat-content">
                <div class="chat-header">
                    <div class="chat-name">
                        <span class="chat-name-text">Study Group</span>
                        <svg class="muted-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z" />
                        </svg>
                    </div>
                    <div class="chat-time">7:23 PM</div>
                </div>
                <div class="chat-message">
                    <div class="message-preview">
                        Alex: Chapter 5 notes are uploaded
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    </div>

    <!-- Members Panel (see members_panel_html.html artifact for full structure) -->
    <div class="members-panel-overlay" id="membersPanelOverlay"></div>
    <div class="members-panel" id="membersPanel">
        <div class="members-header">
            <div class="members-title">Members (24)</div>
            <button class="close-btn" id="closeMembersPanel">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                </svg>
            </button>
        </div>
        <div class="members-search">
            <input type="text" id="memberSearch" placeholder="Search members...">
        </div>
        <div class="members-filters">
            <button class="filter-btn active" data-filter="all">All</button>
            <button class="filter-btn" data-filter="admin">Admins</button>
            <button class="filter-btn" data-filter="moderator">Mods</button>
            <button class="filter-btn" data-filter="member">Members</button>
        </div>
        <div class="members-list" id="membersList"></div>
    </div>

    <!-- Profile Sheet -->
    <div class="profile-sheet-overlay" id="profileSheetOverlay">
        <div class="profile-sheet" id="profileSheet"></div>
    </div>

    <!-- Node Creation Modal (see modal_html.html artifact for full structure) -->
    <div class="modal-overlay" id="createNodeModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Create Node</div>
                <button class="close-btn" id="closeModal">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Node Name *</label>
                    <input type="text" class="form-input" id="nodeName" placeholder="e.g., Weekend Plans"
                        maxlength="50">
                    <div class="char-count"><span id="nameCount">0</span>/50</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" id="nodeDescription" placeholder="What's this node about?"
                        maxlength="200"></textarea>
                    <div class="char-count"><span id="descCount">0</span>/200</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Theme</label>
                    <div class="theme-selector">
                        <div class="theme-option selected" data-theme="professional">
                            <div class="theme-color professional"></div>
                            <div class="theme-label">Professional</div>
                        </div>
                        <div class="theme-option" data-theme="personal">
                            <div class="theme-color personal"></div>
                            <div class="theme-label">Personal</div>
                        </div>
                        <div class="theme-option" data-theme="recreation">
                            <div class="theme-color recreation"></div>
                            <div class="theme-label">Recreation</div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Invite Members</label>
                    <div class="invite-tabs">
                        <button class="invite-tab active" data-invite="manual">Manual</button>
                        <button class="invite-tab" data-invite="qr">QR Code</button>
                        <button class="invite-tab" data-invite="link">Link</button>
                    </div>
                    <div class="invite-content active" id="manualInvite">
                        <input type="text" class="form-input" placeholder="Search contacts..."
                            style="margin-bottom: 12px;">
                        <div class="contact-list">
                            <div class="contact-item clickable-item"><input type="checkbox" class="contact-checkbox">
                                <div class="contact-avatar avatar-blue">JD</div>
                                <div class="contact-info">
                                    <div class="contact-name">John Doe</div>
                                    <div class="contact-username">@johndoe</div>
                                </div>
                            </div>
                            <div class="contact-item clickable-item"><input type="checkbox" class="contact-checkbox">
                                <div class="contact-avatar avatar-green">SM</div>
                                <div class="contact-info">
                                    <div class="contact-name">Sarah Miller</div>
                                    <div class="contact-username">@sarahm</div>
                                </div>
                            </div>
                            <div class="contact-item clickable-item"><input type="checkbox" class="contact-checkbox">
                                <div class="contact-avatar avatar-orange">MJ</div>
                                <div class="contact-info">
                                    <div class="contact-name">Mike Johnson</div>
                                    <div class="contact-username">@mikej</div>
                                </div>
                            </div>
                        </div>
                        <div class="selected-count" id="selectedCount">0 selected</div>
                    </div>
                    <div class="invite-content" id="qrInvite">
                        <div class="qr-code-container">
                            <div class="qr-code-display">
                                <div
                                    style="width: 100%; height: 100%; background: repeating-linear-gradient(0deg, #000 0px, #000 2px, #fff 2px, #fff 4px), repeating-linear-gradient(90deg, #000 0px, #000 2px, #fff 2px, #fff 4px);">
                                </div>
                            </div>
                            <div class="qr-instructions">Scan this QR code to join the node</div>
                            <button class="btn btn-secondary">Download QR Code</button>
                        </div>
                    </div>
                    <div class="invite-content" id="linkInvite">
                        <div class="invite-link-box">
                            <input type="text" class="invite-link-input" id="inviteLink" value="t.me/nodes/abc123xyz"
                                readonly>
                            <button class="copy-btn" id="copyLinkBtn">Copy</button>
                        </div>
                        <div style="margin-top: 16px;">
                            <label class="form-label">Share Cards</label>
                            <div class="share-card-tabs">
                                <div class="share-card-tab active" data-card="square">Square</div>
                                <div class="share-card-tab" data-card="instagram">Instagram</div>
                            </div>
                            <div class="share-card-preview">
                                <div class="share-card-image" id="shareCardPreview">
                                    <div class="share-card-node-name" id="shareCardName">My New Node</div>
                                    <div class="share-card-qr">QR Code</div>
                                    <div class="share-card-cta">Scan to Join on Telegram</div>
                                </div>
                            </div>
                            <div class="share-actions">
                                <button class="share-btn share-btn-download">Download</button>
                                <button class="share-btn share-btn-share">Share</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelBtn">Cancel</button>
                <button class="btn btn-primary" id="createBtn">Create Node</button>
            </div>
        </div>
    </div>

    <!-- Theme Toggle Button -->
    <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
        <svg id="sunIcon" viewBox="0 0 24 24">
            <path
                d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z" />
        </svg>
        <svg id="moonIcon" viewBox="0 0 24 24" style="display: none;">
            <path
                d="M9 2c-1.05 0-2.05.16-3 .46 4.06 1.27 7 5.06 7 9.54 0 4.48-2.94 8.27-7 9.54.95.3 1.95.46 3 .46 5.52 0 10-4.48 10-10S14.52 2 9 2z" />
        </svg>
    </button>

    <script>
        // Shared Utility Functions
        function toggleActive(elements, activeElement) {
            elements.forEach(el => el.classList.remove('active'));
            if (activeElement) activeElement.classList.add('active');
        }

        function switchContent(containers, activeId) {
            Object.values(containers).forEach(id => {
                const el = document.getElementById(id);
                if (el) el.classList.remove('active');
            });
            const active = document.getElementById(activeId);
            if (active) active.classList.add('active');
        }

        function capitalize(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        // Theme Toggle Functionality
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;
        const sunIcon = document.getElementById('sunIcon');
        const moonIcon = document.getElementById('moonIcon');

        // Check for saved theme preference or default to 'day'
        const currentTheme = localStorage.getItem('theme') || 'day';

        if (currentTheme === 'night') {
            body.classList.add('night-mode');
            sunIcon.style.display = 'none';
            moonIcon.style.display = 'block';
        }

        themeToggle.addEventListener('click', () => {
            body.classList.toggle('night-mode');

            if (body.classList.contains('night-mode')) {
                localStorage.setItem('theme', 'night');
                sunIcon.style.display = 'none';
                moonIcon.style.display = 'block';
            } else {
                localStorage.setItem('theme', 'day');
                sunIcon.style.display = 'block';
                moonIcon.style.display = 'none';
            }
        });

        // Sidebar Navigation Functionality
        const menuIcons = document.querySelectorAll('.menu-icon');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        const chatsNav = document.getElementById('chatsNav');
        const userProfile = document.getElementById('userProfile');
        const addNodeBtn = document.getElementById('addNodeBtn');
        const nodeItems = document.querySelectorAll('.node-item');

        // Open sidebar
        function openSidebar() {
            sidebar.classList.add('active');
            sidebarOverlay.classList.add('active');
            body.classList.add('sidebar-open');
        }

        // Close sidebar
        function closeSidebar() {
            sidebar.classList.remove('active');
            sidebarOverlay.classList.remove('active');
            body.classList.remove('sidebar-open');
        }

        // Hamburger menu click (Global & Node-level)
        menuIcons.forEach(icon => {
            icon.addEventListener('click', (e) => {
                e.stopPropagation();
                openSidebar();
            });
        });

        // Overlay click to close
        sidebarOverlay.addEventListener('click', closeSidebar);

        // Chats navigation - close sidebar and return to home
        chatsNav.addEventListener('click', () => {
            closeSidebar();
            // Hide all node interfaces
            document.querySelectorAll('.node-interface').forEach(ni => {
                ni.classList.remove('active');
            });
        });

        // User profile click (placeholder - no functionality)
        userProfile.addEventListener('click', () => {
            console.log('User profile clicked - Settings/Profile placeholder');
            closeSidebar();
        });

        // Add node button click (placeholder)
        addNodeBtn.addEventListener('click', () => {
            console.log('Create Node clicked - Node creation placeholder');
            closeSidebar();
        });

        // Node item clicks - open respective node interface
        nodeItems.forEach(item => {
            item.addEventListener('click', () => {
                const nodeName = item.getAttribute('data-node');
                closeSidebar();

                // Hide all node interfaces first
                document.querySelectorAll('.node-interface').forEach(ni => {
                    ni.classList.remove('active');
                });

                // Show the selected node interface
                const nodeInterface = document.getElementById(`nodeInterface${capitalize(nodeName)}`);
                if (nodeInterface) {
                    nodeInterface.classList.add('active');
                }
            });
        });



        // Helper function to capitalize first letter
        function capitalize(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        // Swipe gesture support for opening sidebar (optional enhancement)
        let touchStartX = 0;
        let touchEndX = 0;

        document.addEventListener('touchstart', (e) => {
            touchStartX = e.changedTouches[0].screenX;
        });

        document.addEventListener('touchend', (e) => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });

        function handleSwipe() {
            // Swipe right from left edge (within 50px)
            if (touchStartX < 50 && touchEndX > touchStartX + 50) {
                openSidebar();
            }
        }

        // Chat item clicks (placeholder)
        document.querySelectorAll('.chat-item').forEach(item => {
            item.addEventListener('click', function () {
                console.log('Chat clicked:', this.querySelector('.chat-name-text').textContent);
            });
        });

        // Channel Chat System
        const channelData = {
            'work': {
                'Sprint Planning': {
                    messages: [
                        // Older messages (not shown in grid preview)
                        { sender: 'Mike Johnson', role: 'admin', avatar: 'MJ', avatarColor: 'avatar-green', text: 'Starting sprint 42 today!', time: '8:00 AM' },
                        { sender: 'Rachel Park', role: 'admin', avatar: 'RP', avatarColor: 'avatar-blue', text: 'Let\'s review the backlog first', time: '8:15 AM' },
                        { sender: 'Alex Kim', role: 'moderator', avatar: 'AK', avatarColor: 'avatar-orange', text: 'I\'ve prioritized the tickets', time: '8:30 AM' },
                        { sender: 'Emma Davis', role: 'moderator', avatar: 'ED', avatarColor: 'avatar-purple', text: 'Good list, looks manageable', time: '8:40 AM' },
                        { sender: 'Tom Wilson', role: 'member', avatar: 'TW', avatarColor: 'avatar-red', text: 'Excited to get started!', time: '8:50 AM' },
                        // Recent messages (shown in grid preview)
                        { sender: 'Rachel Park', role: 'admin', avatar: 'RP', avatarColor: 'avatar-blue', text: 'Updated the sprint board', time: '9:00 AM' },
                        { sender: 'Mike Johnson', role: 'admin', avatar: 'MJ', avatarColor: 'avatar-green', text: 'Ready for review', time: '9:15 AM' },
                        { sender: 'Alex Kim', role: 'moderator', avatar: 'AK', avatarColor: 'avatar-orange', text: 'I\'ll take a look', time: '9:30 AM' },
                        { sender: 'Emma Davis', role: 'moderator', avatar: 'ED', avatarColor: 'avatar-purple', text: 'Approved!', time: '10:00 AM' },
                        { sender: 'Tom Wilson', role: 'member', avatar: 'TW', avatarColor: 'avatar-red', text: 'Thanks everyone!', time: '10:32 AM' }
                    ]
                },
                'Daily Standup': {
                    messages: [
                        // Older messages
                        { sender: 'Rachel Park', role: 'admin', avatar: 'RP', avatarColor: 'avatar-blue', text: 'Good morning team!', time: '8:30 AM' },
                        { sender: 'Mike Johnson', role: 'admin', avatar: 'MJ', avatarColor: 'avatar-green', text: 'Morning! Ready for standup', time: '8:32 AM' },
                        { sender: 'Tom Wilson', role: 'member', avatar: 'TW', avatarColor: 'avatar-red', text: 'Working on the dashboard today', time: '8:35 AM' },
                        { sender: 'Emma Davis', role: 'moderator', avatar: 'ED', avatarColor: 'avatar-purple', text: 'I\'ll finish the login page', time: '8:40 AM' },
                        { sender: 'Rachel Park', role: 'admin', avatar: 'RP', avatarColor: 'avatar-blue', text: 'Great, let\'s sync at noon', time: '8:45 AM' },
                        // Recent messages
                        { sender: 'Alex Kim', role: 'moderator', avatar: 'AK', avatarColor: 'avatar-orange', text: 'Blocker on API integration', time: '9:00 AM' },
                        { sender: 'Rachel Park', role: 'admin', avatar: 'RP', avatarColor: 'avatar-blue', text: 'Let me help with that', time: '9:15 AM' },
                        { sender: 'Mike Johnson', role: 'admin', avatar: 'MJ', avatarColor: 'avatar-green', text: 'I can assist too', time: '9:20 AM' },
                        { sender: 'Alex Kim', role: 'moderator', avatar: 'AK', avatarColor: 'avatar-orange', text: 'Issue resolved, thanks!', time: '9:45 AM' }
                    ]
                },
                'Frontend': {
                    messages: [
                        // Older messages
                        { sender: 'Alex Kim', role: 'moderator', avatar: 'AK', avatarColor: 'avatar-orange', text: 'Started on the new header', time: '8:00 AM' },
                        { sender: 'Emma Davis', role: 'moderator', avatar: 'ED', avatarColor: 'avatar-purple', text: 'Using the new design system', time: '8:10 AM' },
                        { sender: 'Tom Wilson', role: 'member', avatar: 'TW', avatarColor: 'avatar-red', text: 'Responsive breakpoints are ready', time: '8:20 AM' },
                        { sender: 'Rachel Park', role: 'admin', avatar: 'RP', avatarColor: 'avatar-blue', text: 'Looking forward to seeing it', time: '8:30 AM' },
                        { sender: 'Mike Johnson', role: 'admin', avatar: 'MJ', avatarColor: 'avatar-green', text: 'Great progress today', time: '8:40 AM' },
                        // Recent messages
                        { sender: 'Emma Davis', role: 'moderator', avatar: 'ED', avatarColor: 'avatar-purple', text: 'New component ready', time: '8:50 AM' },
                        { sender: 'Tom Wilson', role: 'member', avatar: 'TW', avatarColor: 'avatar-red', text: 'Looks great!', time: '8:55 AM' },
                        { sender: 'Alex Kim', role: 'moderator', avatar: 'AK', avatarColor: 'avatar-orange', text: 'Passed review', time: '9:00 AM' },
                        { sender: 'Rachel Park', role: 'admin', avatar: 'RP', avatarColor: 'avatar-blue', text: 'Nice work Emma!', time: '9:05 AM' },
                        { sender: 'Emma Davis', role: 'moderator', avatar: 'ED', avatarColor: 'avatar-purple', text: 'Thanks team!', time: '9:10 AM' }
                    ]
                },
                'Backend': {
                    messages: [
                        // Older messages
                        { sender: 'Mike Johnson', role: 'admin', avatar: 'MJ', avatarColor: 'avatar-green', text: 'Starting the migration script', time: '2 days ago' },
                        { sender: 'Tom Wilson', role: 'member', avatar: 'TW', avatarColor: 'avatar-red', text: 'Backup complete', time: '2 days ago' },
                        { sender: 'Rachel Park', role: 'admin', avatar: 'RP', avatarColor: 'avatar-blue', text: 'Proceed when ready', time: '2 days ago' },
                        { sender: 'Alex Kim', role: 'moderator', avatar: 'AK', avatarColor: 'avatar-orange', text: 'Running migration now', time: '2 days ago' },
                        { sender: 'Mike Johnson', role: 'admin', avatar: 'MJ', avatarColor: 'avatar-green', text: 'No errors so far', time: '2 days ago' },
                        // Recent messages
                        { sender: 'Tom Wilson', role: 'member', avatar: 'TW', avatarColor: 'avatar-red', text: 'Database migration complete', time: 'Yesterday' },
                        { sender: 'Mike Johnson', role: 'admin', avatar: 'MJ', avatarColor: 'avatar-green', text: 'Verified on staging', time: 'Yesterday' },
                        { sender: 'Alex Kim', role: 'moderator', avatar: 'AK', avatarColor: 'avatar-orange', text: 'API endpoints updated', time: 'Yesterday' },
                        { sender: 'Tom Wilson', role: 'member', avatar: 'TW', avatarColor: 'avatar-red', text: 'Ready for production', time: 'Yesterday' },
                        { sender: 'Rachel Park', role: 'admin', avatar: 'RP', avatarColor: 'avatar-blue', text: 'Good to deploy', time: 'Yesterday' }
                    ]
                },
                'DevOps': {
                    messages: [
                        // Older messages
                        { sender: 'Lisa Chen', role: 'moderator', avatar: 'LC', avatarColor: 'avatar-cyan', text: 'Setting up new cluster', time: '2 days ago' },
                        { sender: 'Mike Johnson', role: 'admin', avatar: 'MJ', avatarColor: 'avatar-green', text: 'Kubernetes config looks good', time: '2 days ago' },
                        { sender: 'Tom Wilson', role: 'member', avatar: 'TW', avatarColor: 'avatar-red', text: 'Docker images pushed', time: '2 days ago' },
                        { sender: 'Rachel Park', role: 'admin', avatar: 'RP', avatarColor: 'avatar-blue', text: 'Security scan passed', time: '2 days ago' },
                        { sender: 'Lisa Chen', role: 'moderator', avatar: 'LC', avatarColor: 'avatar-cyan', text: 'Ready for pipeline setup', time: '2 days ago' },
                        // Recent messages
                        { sender: 'Lisa Chen', role: 'moderator', avatar: 'LC', avatarColor: 'avatar-cyan', text: 'Deployment pipeline updated', time: 'Yesterday' },
                        { sender: 'Mike Johnson', role: 'admin', avatar: 'MJ', avatarColor: 'avatar-green', text: 'CI/CD looking good', time: 'Yesterday' },
                        { sender: 'Lisa Chen', role: 'moderator', avatar: 'LC', avatarColor: 'avatar-cyan', text: 'Added staging environment', time: 'Yesterday' },
                        { sender: 'Tom Wilson', role: 'member', avatar: 'TW', avatarColor: 'avatar-red', text: 'Tests passing', time: 'Yesterday' },
                        { sender: 'Rachel Park', role: 'admin', avatar: 'RP', avatarColor: 'avatar-blue', text: 'Great work Lisa!', time: 'Yesterday' }
                    ]
                }
            },
            'family': {
                'Family Chat': {
                    messages: [
                        { sender: 'Mom', role: 'admin', avatar: 'M', text: 'Dinner at 7 PM tonight', time: '2:00 PM' },
                        { sender: 'Dad', role: 'member', avatar: 'D', text: 'I\'ll be there', time: '2:15 PM' },
                        { sender: 'Sister', role: 'member', avatar: 'S', text: 'Can I bring dessert?', time: '2:30 PM' },
                        { sender: 'Mom', role: 'admin', avatar: 'M', text: 'That would be lovely!', time: '2:45 PM' }
                    ]
                }
            },
            'hobbies': {
                'Landscape Photography': {
                    messages: [
                        // Older messages
                        { sender: 'Tom Anderson', role: 'admin', avatar: 'TA', text: 'Anyone going out this weekend?', time: '6:00 AM' },
                        { sender: 'Sarah Miller', role: 'member', avatar: 'SM', text: 'Planning to hit the coast', time: '6:10 AM' },
                        { sender: 'Alex Wong', role: 'moderator', avatar: 'AW', text: 'Weather looks perfect', time: '6:20 AM' },
                        { sender: 'Mike Chen', role: 'admin', avatar: 'MC', text: 'I\'m heading to the mountains', time: '6:30 AM' },
                        { sender: 'Tom Anderson', role: 'admin', avatar: 'TA', text: 'Share your shots after!', time: '6:45 AM' },
                        // Recent messages
                        { sender: 'Mike Chen', role: 'admin', avatar: 'MC', text: 'Just got back from a sunrise shoot at the mountains!', time: '7:00 AM' },
                        { sender: 'Alex Wong', role: 'moderator', avatar: 'AW', text: 'Can\'t wait to see the photos!', time: '7:15 AM' },
                        { sender: 'Sarah Miller', role: 'member', avatar: 'SM', text: 'What settings did you use?', time: '7:30 AM' },
                        { sender: 'Mike Chen', role: 'admin', avatar: 'MC', text: 'ISO 100, f/11, 1/125s with polarizer filter', time: '7:45 AM' },
                        { sender: 'Tom Anderson', role: 'admin', avatar: 'TA', text: 'Great setup! The polarizer really helps with sky contrast', time: '8:00 AM' }
                    ]
                },
                'Portrait Techniques': {
                    messages: [
                        // Older messages
                        { sender: 'Mike Chen', role: 'admin', avatar: 'MC', avatarColor: 'avatar-blue', text: 'Welcome to the portrait channel!', time: '7:00 AM' },
                        { sender: 'Alex Wong', role: 'moderator', avatar: 'AW', avatarColor: 'avatar-orange', text: 'Great place to share tips', time: '7:15 AM' },
                        { sender: 'Sarah Miller', role: 'member', avatar: 'SM', avatarColor: 'avatar-purple', text: 'Looking to improve my portraits', time: '7:30 AM' },
                        { sender: 'Tom Anderson', role: 'admin', avatar: 'TA', avatarColor: 'avatar-green', text: 'I mainly shoot environmental portraits', time: '7:45 AM' },
                        { sender: 'Emma Torres', role: 'moderator', avatar: 'ET', avatarColor: 'avatar-pink', text: 'Natural light is my favorite', time: '8:00 AM' },
                        // Recent messages
                        { sender: 'Emma Torres', role: 'moderator', avatar: 'ET', avatarColor: 'avatar-pink', text: 'Tips for natural light portraits', time: '8:32 AM' },
                        { sender: 'Sarah Miller', role: 'member', avatar: 'SM', avatarColor: 'avatar-purple', text: 'Try shooting during golden hour', time: '8:40 AM' },
                        { sender: 'Mike Chen', role: 'admin', avatar: 'MC', avatarColor: 'avatar-blue', text: 'Window light is also great indoors', time: '8:45 AM' },
                        { sender: 'Alex Wong', role: 'moderator', avatar: 'AW', avatarColor: 'avatar-orange', text: 'What about reflectors?', time: '8:50 AM' },
                        { sender: 'Emma Torres', role: 'moderator', avatar: 'ET', avatarColor: 'avatar-pink', text: 'White foam boards work great as DIY reflectors!', time: '8:55 AM' }
                    ]
                },
                'Camera Bodies': {
                    messages: [
                        // Older messages
                        { sender: 'Tom Anderson', role: 'admin', avatar: 'TA', avatarColor: 'avatar-green', text: 'R5 vs R6 - thoughts?', time: '7:00 AM' },
                        { sender: 'Sarah Miller', role: 'member', avatar: 'SM', avatarColor: 'avatar-purple', text: 'R5 for video, R6 for stills?', time: '7:15 AM' },
                        { sender: 'Alex Wong', role: 'moderator', avatar: 'AW', avatarColor: 'avatar-orange', text: 'R6 has better low light', time: '7:30 AM' },
                        { sender: 'Mike Chen', role: 'admin', avatar: 'MC', avatarColor: 'avatar-blue', text: 'Both are amazing cameras', time: '7:40 AM' },
                        { sender: 'Tom Anderson', role: 'admin', avatar: 'TA', avatarColor: 'avatar-green', text: 'Looking at new lenses now', time: '7:50 AM' },
                        // Recent messages
                        { sender: 'Mike Chen', role: 'admin', avatar: 'MC', avatarColor: 'avatar-blue', text: 'Just got the RF 100-500mm!', time: '8:00 AM' },
                        { sender: 'Alex Wong', role: 'moderator', avatar: 'AW', avatarColor: 'avatar-orange', text: 'How is it? Worth the price?', time: '8:15 AM' },
                        { sender: 'Mike Chen', role: 'admin', avatar: 'MC', avatarColor: 'avatar-blue', text: 'Absolutely! The image stabilization is incredible', time: '8:30 AM' },
                        { sender: 'Tom Anderson', role: 'admin', avatar: 'TA', avatarColor: 'avatar-green', text: 'I\'ve been considering that lens too', time: '9:00 AM' },
                        { sender: 'Sarah Miller', role: 'member', avatar: 'SM', avatarColor: 'avatar-purple', text: 'Can\'t wait to see your photos!', time: '9:15 AM' }
                    ]
                },
                'Gear Discussions': {
                    messages: [
                        // Older messages
                        { sender: 'Alex Wong', role: 'moderator', avatar: 'AW', text: 'New tripod recommendations?', time: '7:00 AM' },
                        { sender: 'Tom Anderson', role: 'admin', avatar: 'TA', text: 'Peak Design Travel Tripod', time: '7:10 AM' },
                        { sender: 'Sarah Miller', role: 'member', avatar: 'SM', text: 'Gitzo is my go-to', time: '7:20 AM' },
                        { sender: 'Mike Chen', role: 'admin', avatar: 'MC', text: 'Both solid choices!', time: '7:35 AM' },
                        { sender: 'Alex Wong', role: 'moderator', avatar: 'AW', text: 'Thanks for the recs!', time: '7:50 AM' },
                        // Recent messages
                        { sender: 'Mike Chen', role: 'admin', avatar: 'MC', text: 'Just got the RF 100-500mm!', time: '8:00 AM' },
                        { sender: 'Alex Wong', role: 'moderator', avatar: 'AW', text: 'How is it? Worth the price?', time: '8:15 AM' },
                        { sender: 'Mike Chen', role: 'admin', avatar: 'MC', text: 'Absolutely! The image stabilization is incredible', time: '8:30 AM' },
                        { sender: 'Tom Anderson', role: 'admin', avatar: 'TA', text: 'I\'ve been considering that lens too', time: '9:00 AM' },
                        { sender: 'Sarah Miller', role: 'member', avatar: 'SM', text: 'Can\'t wait to see your photos!', time: '9:15 AM' }
                    ]
                }
            }
        };

        let activeChannel = null;
        let activeNode = null;

        // Create channel chat HTML structure
        function createChannelChatHTML() {
            if (document.getElementById('channelChat')) return; // Already exists

            const channelChatHTML = `
                <div class="channel-chat" id="channelChat">
                    <div class="channel-chat-header">
                        <div class="channel-chat-back" onclick="closeChannelChat()">
                            <svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
                        </div>
                        <div class="channel-chat-icon" id="channelChatIcon">#</div>
                        <div class="channel-chat-info">
                            <div class="channel-chat-name" id="channelChatName">Channel</div>
                            <div class="channel-chat-count" id="channelChatCount">1177 messages</div>
                        </div>
                        <button class="channel-chat-menu" onclick="toggleChannelActionMenu(event)">
                            <svg viewBox="0 0 24 24"><path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>
                            <div class="channel-action-dropdown" id="channelActionDropdown">
                               <!-- Items will be injected based on node role -->
                            </div>
                        </button>
                    </div>
                    <div class="channel-messages" id="channelMessages">
                        <div class="pinned-message">
                            <div style="flex: 1;">
                                <div class="pinned-message-label">Pinned Message</div>
                                <div class="pinned-message-text">Sprint deadline: Dec 20. All tasks must be completed by EOD Friday. Review meeting at 2 PM.</div>
                            </div>
                            <button class="pinned-message-close"></button>
                        </div>
                        <!-- Messages will be injected here -->
                    </div>
                    <div class="channel-message-input">
                        <button class="message-input-btn">
                            <svg viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM9 11H7V9h2v2zm4 0h-2V9h2v2zm4 0h-2V9h2v2z"/></svg>
                        </button>
                        <input type="text" class="message-input-field" placeholder="Message" />
                        <button class="message-input-btn">
                            <svg viewBox="0 0 24 24"><path d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"/></svg>
                        </button>
                        <button class="message-input-btn">
                            <svg viewBox="0 0 24 24"><path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"/></svg>
                        </button>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', channelChatHTML);

            // Click outside dropdown to close
            document.addEventListener('click', function (e) {
                const dropdown = document.getElementById('channelActionDropdown');
                const menuBtn = document.querySelector('.channel-chat-menu');
                if (dropdown && !dropdown.contains(e.target) && !menuBtn.contains(e.target)) {
                    dropdown.classList.remove('active');
                }
            });
        }

        function openChannelChat(channelName, nodeName) {
            createChannelChatHTML();

            activeChannel = channelName;
            activeNode = nodeName;

            const channelChat = document.getElementById('channelChat');
            const channelChatName = document.getElementById('channelChatName');
            const channelMessagesContainer = document.getElementById('channelMessages');

            channelChatName.textContent = channelName;
            channelChat.classList.add('active');

            // Render messages
            const messages = channelData[nodeName] && channelData[nodeName][channelName]
                ? channelData[nodeName][channelName].messages
                : [];

            const messagesHTML = messages.map((msg, index) => {
                // Use avatarColor from data, or fall back to index-based assignment
                const avatarColors = ['avatar-blue', 'avatar-green', 'avatar-orange', 'avatar-purple', 'avatar-red', 'avatar-cyan', 'avatar-pink', 'avatar-yellow'];
                const avatarClass = msg.avatarColor || avatarColors[index % avatarColors.length];

                return `
                <div class="message-bubble">
                    <div class="message-avatar ${avatarClass}">
                        ${msg.avatar}
                    </div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-sender">${msg.sender}</span>
                            <span class="message-role-badge ${msg.role}">${msg.role}</span>
                        </div>
                        <div class="message-text">${msg.text}</div>
                        <div class="message-time">${msg.time}</div>
                    </div>
                </div>
            `;
            }).join('');

            // Keep pinned message and add messages
            const pinnedMsg = channelMessagesContainer.querySelector('.pinned-message');
            channelMessagesContainer.innerHTML = '';
            if (pinnedMsg) channelMessagesContainer.appendChild(pinnedMsg);
            channelMessagesContainer.insertAdjacentHTML('beforeend', messagesHTML);

            // Setup action menu based on node role
            setupChannelActionMenu(nodeName);

            // Scroll to bottom
            channelMessagesContainer.scrollTop = channelMessagesContainer.scrollHeight;
        }

        function closeChannelChat() {
            const channelChat = document.getElementById('channelChat');
            if (channelChat) {
                channelChat.classList.remove('active');
            }
        }

        function toggleChannelActionMenu(event) {
            event.stopPropagation();
            const dropdown = document.getElementById('channelActionDropdown');
            dropdown.classList.toggle('active');
        }

        function setupChannelActionMenu(nodeName) {
            const dropdown = document.getElementById('channelActionDropdown');
            const isAdmin = nodeName === 'work'; // Astra Dynamics is admin

            const commonActions = `
                <button class="channel-action-item" onclick="channelAction('leave')">Leave channel</button>
                <button class="channel-action-item" onclick="channelAction('mute')">Mute channel</button>
                <button class="channel-action-item" onclick="channelAction('report')">Report channel</button>
                <button class="channel-action-item" onclick="channelAction('search')">Search in channel</button>
                <button class="channel-action-item" onclick="channelAction('unread')">Mark as unread</button>
            `;

            const adminActions = isAdmin ? `
                <button class="channel-action-item" onclick="channelAction('edit')">Edit channel info</button>
                <button class="channel-action-item" onclick="channelAction('archive')">Archive channel</button>
                <button class="channel-action-item danger" onclick="channelAction('delete')">Delete channel</button>
            ` : '';

            dropdown.innerHTML = commonActions + adminActions;
        }

        function channelAction(action) {
            const dropdown = document.getElementById('channelActionDropdown');
            dropdown.classList.remove('active');

            switch (action) {
                case 'delete':
                    customAlert.confirm(
                        `Delete "${activeChannel}"?\\n\\nThis action cannot be undone. All messages will be permanently deleted.`,
                        'Delete Channel',
                        { confirmText: 'DELETE', isDestructive: true }
                    ).then(confirmed => {
                        if (confirmed) {
                            customAlert.alert(' Channel deleted.\\n\\nNote: This is a prototype.');
                            closeChannelChat();
                        }
                    });
                    break;
                case 'leave':
                    customAlert.alert('Channel action: Leave\\n\\nNote: This is a prototype.');
                    break;
                case 'mute':
                    customAlert.alert('Channel action: Mute\\n\\nNote: This is a prototype.');
                    break;
                case 'report':
                    customAlert.alert('Channel action: Report\\n\\nNote: This is a prototype.');
                    break;
                case 'search':
                    customAlert.alert('Channel action: Search\\n\\nNote: This is a prototype.');
                    break;
                case 'unread':
                    customAlert.alert('Channel action: Mark as unread\\n\\nNote: This is a prototype.');
                    break;
                case 'edit':
                    customAlert.alert('Channel action: Edit info\\n\\nNote: This is a prototype.');
                    break;
                case 'archive':
                    customAlert.alert('Channel action: Archive\\n\\nNote: This is a prototype.');
                    break;
            }
        }

        // Admin Menu Toggle
        function toggleAdminMenu(event) {
            event.stopPropagation();
            const dropdown = document.getElementById('adminMenuDropdown');
            if (dropdown) {
                dropdown.classList.toggle('active');
            }
        }

        // Close admin menu when clicking outside
        document.addEventListener('click', function (e) {
            const dropdown = document.getElementById('adminMenuDropdown');
            const adminBtn = document.querySelector('.admin-settings-btn');
            if (dropdown && adminBtn && !adminBtn.contains(e.target)) {
                dropdown.classList.remove('active');
            }
        });

        // Add Event Modal Functions
        let currentEventType = 'poll';
        let pollOptionCount = 2;

        function addEvent() {
            // Reset form
            document.getElementById('eventTitleInput').value = '';
            document.getElementById('eventDescInput').value = '';
            document.getElementById('eventDateTime').value = '';
            document.getElementById('eventLocation').value = '';
            resetPollOptions();
            selectEventType('poll');

            // Open modal
            document.getElementById('addEventModal').classList.add('active');
        }

        function closeEventModal() {
            document.getElementById('addEventModal').classList.remove('active');
        }

        function selectEventType(type) {
            currentEventType = type;

            // Update tab styling
            document.querySelectorAll('.event-type-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.type === type);
            });

            // Show/hide relevant fields
            document.querySelectorAll('.meeting-field').forEach(field => {
                field.style.display = type === 'meeting' ? 'block' : 'none';
            });
            document.querySelectorAll('.poll-field').forEach(field => {
                field.style.display = type === 'poll' ? 'block' : 'none';
            });

            // Update preview
            updateEventPreview();
        }

        function addPollOption() {
            pollOptionCount++;
            const container = document.getElementById('pollOptionsContainer');
            const newOption = document.createElement('div');
            newOption.className = 'poll-option-input';
            newOption.innerHTML = `
                <input type="text" class="form-input" placeholder="Option ${pollOptionCount}">
                <button class="remove-option-btn" onclick="removePollOption(this)"></button>
            `;
            container.appendChild(newOption);
            updateRemoveButtons();
        }

        function removePollOption(btn) {
            btn.closest('.poll-option-input').remove();
            pollOptionCount--;
            updateRemoveButtons();
            reorderPollPlaceholders();
        }

        function updateRemoveButtons() {
            const options = document.querySelectorAll('.poll-option-input');
            options.forEach(opt => {
                const removeBtn = opt.querySelector('.remove-option-btn');
                if (removeBtn) {
                    removeBtn.style.display = options.length > 2 ? 'flex' : 'none';
                }
            });
        }

        function reorderPollPlaceholders() {
            const options = document.querySelectorAll('.poll-option-input input');
            options.forEach((input, index) => {
                input.placeholder = `Option ${index + 1}`;
            });
        }

        function resetPollOptions() {
            pollOptionCount = 2;
            const container = document.getElementById('pollOptionsContainer');
            container.innerHTML = `
                <div class="poll-option-input">
                    <input type="text" class="form-input" placeholder="Option 1">
                    <button class="remove-option-btn" onclick="removePollOption(this)" style="display:none;"></button>
                </div>
                <div class="poll-option-input">
                    <input type="text" class="form-input" placeholder="Option 2">
                    <button class="remove-option-btn" onclick="removePollOption(this)" style="display:none;"></button>
                </div>
            `;
        }

        function updateEventPreview() {
            const title = document.getElementById('eventTitleInput').value || 'Event Title';
            const desc = document.getElementById('eventDescInput').value || 'Event description will appear here...';

            document.getElementById('previewEventTitle').textContent = title;
            document.getElementById('previewEventDesc').textContent = desc;

            const typeLabels = { poll: 'Poll', meeting: 'Scheduled Meeting', announcement: 'Announcement' };
            document.getElementById('previewEventType').textContent = typeLabels[currentEventType];

            // Update icon based on type
            const iconPaths = {
                poll: 'M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z',
                meeting: 'M17 10H7v2h10v-2zm2-7h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z',
                announcement: 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z'
            };
            document.getElementById('previewEventIcon').innerHTML = `<path d="${iconPaths[currentEventType]}"/>`;
        }

        async function createEvent() {
            const title = document.getElementById('eventTitleInput').value.trim();
            const desc = document.getElementById('eventDescInput').value.trim();

            if (!title) {
                customAlert.alert('Please enter an event title.');
                return;
            }

            let eventDetails = `Event Type: ${currentEventType.charAt(0).toUpperCase() + currentEventType.slice(1)}\nTitle: ${title}`;

            if (desc) {
                eventDetails += `\nDescription: ${desc}`;
            }

            if (currentEventType === 'meeting') {
                const dateTime = document.getElementById('eventDateTime').value;
                const location = document.getElementById('eventLocation').value;
                if (dateTime) eventDetails += `\nDate/Time: ${new Date(dateTime).toLocaleString()}`;
                if (location) eventDetails += `\nLocation: ${location}`;
            }

            if (currentEventType === 'poll') {
                const options = [];
                document.querySelectorAll('.poll-option-input input').forEach(input => {
                    if (input.value.trim()) options.push(input.value.trim());
                });
                if (options.length > 0) {
                    eventDetails += `\nPoll Options:\n ${options.join('\n ')}`;
                }
            }

            closeEventModal();
            await customAlert.alert(` Event Created!\n\n${eventDetails}\n\nNote: This is a prototype. The event would appear in the Important Events carousel.`, 'Event Created');
        }

        // Live preview updates for event inputs
        document.getElementById('eventTitleInput')?.addEventListener('input', updateEventPreview);
        document.getElementById('eventDescInput')?.addEventListener('input', updateEventPreview);

        // Admin Menu Actions
        async function adminMenuAction(action) {
            const dropdown = document.getElementById('adminMenuDropdown');
            if (dropdown) dropdown.classList.remove('active');

            switch (action) {
                case 'change-avatar':
                    customAlert.alert('Change Node Avatar\\n\\nUpload a new avatar image for Astra Dynamics.\\n\\n[File picker would open here]\\n\\nNote: This is a prototype.');
                    break;
                case 'change-name':
                    customAlert.alert('Change Node Name\\n\\nCurrent name: Astra Dynamics\\n\\nEnter new name in the field below.\\n\\nNote: This is a prototype.');
                    break;
                case 'edit-description':
                    customAlert.alert('Edit Node Description\\n\\nCurrent: Professional workspace for Astra Dynamics team collaboration\\n\\n[Text editor would open here]\\n\\nNote: This is a prototype.');
                    break;
                case 'create-channel':
                    customAlert.alert('Create New Channel\\n\\nEnter channel name and configure settings.\\n\\n[Channel creation form would appear here]\\n\\nNote: This is a prototype.');
                    break;
                case 'manage-roles':
                    customAlert.alert('Manage Roles\\n\\n- Admin: Full control\\n- Moderator: Manage channels and members\\n- Member: Basic access\\n\\n[Role editor would open here]\\n\\nNote: This is a prototype.');
                    break;
                case 'add-members':
                    customAlert.alert('Add Members\\n\\nInvite new members to Astra Dynamics via link, QR code, or direct selection.\\n\\nNote: This is a prototype.');
                    break;
                case 'remove-members':
                    customAlert.alert('Remove Members\\n\\nSelect members to remove from the node.\\n\\nNote: This is a prototype.');
                    break;
                case 'share-link':
                    customAlert.alert('Share Link Generated\\n\\nhttps://t.me/astra_dynamics/invite/abc123\\n\\nLink copied to clipboard!\\n\\nNote: This is a prototype.');
                    break;
                case 'qr-code':
                    customAlert.alert('QR Code Generated\\n\\n[QR Code would be displayed here]\\n\\nScan to join Astra Dynamics\\n\\nNote: This is a prototype.');
                    break;
                case 'permissions':
                    customAlert.alert('Node Permissions\\n\\n Who can invite: Admins only\\n Who can edit info: Admins & Moderators\\n Message permissions: All members\\n\\nNote: This is a prototype.');
                    break;
                case 'archive':
                    const archiveConfirm = await customAlert.confirm(
                        'Archive Astra Dynamics?\\n\\nArchived nodes are hidden but can be restored later.',
                        'Archive Node',
                        { confirmText: 'ARCHIVE', isDestructive: true }
                    );
                    if (archiveConfirm) {
                        customAlert.alert('Node archived successfully.\\n\\nNote: This is a prototype.');
                    }
                    break;
                case 'delete':
                    const deleteConfirm = await customAlert.confirm(
                        'Delete Astra Dynamics?\\n\\nThis action cannot be undone. All channels and messages will be permanently deleted.',
                        'Delete Node',
                        { confirmText: 'DELETE', isDestructive: true }
                    );
                    if (deleteConfirm) {
                        customAlert.alert('Node deleted.\\n\\nNote: This is a prototype.');
                    }
                    break;
            }
        }

        // Setup click handlers for channel items - Make NESTED channels clickable, not section titles
        function setupChannelClickHandlers(nodeName) {
            const nodeInterface = document.getElementById(`nodeInterface${capitalize(nodeName)}`);
            if (!nodeInterface) return;

            // Remove clickable class from section titles (channel-item) to make them non-clickable
            const sectionTitles = nodeInterface.querySelectorAll('.channel-item.clickable-item');
            sectionTitles.forEach(title => {
                title.classList.remove('clickable-item');
                title.style.cursor = 'default';
            });

            // Get all NESTED channels in LIST VIEW (these should be clickable)
            const nestedChannels = nodeInterface.querySelectorAll('.nested-channel');

            // Make only the FIRST nested channel clickable in list view
            if (nestedChannels.length > 0) {
                const firstNestedChannel = nestedChannels[0];
                firstNestedChannel.style.cursor = 'pointer';
                firstNestedChannel.classList.add('clickable-item');

                firstNestedChannel.addEventListener('click', function (e) {
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();

                    const channelNameEl = this.querySelector('.nested-channel-name');
                    if (channelNameEl) {
                        const channelName = channelNameEl.textContent.trim();
                        openChannelChat(channelName, nodeName);
                    }
                }, true); // Use capture phase

                // Make other nested channels non-clickable
                for (let i = 1; i < nestedChannels.length; i++) {
                    nestedChannels[i].style.cursor = 'default';
                }
            }

            // Get all grid channel cards in GRID VIEW
            const gridCards = nodeInterface.querySelectorAll('.grid-channel-card');

            // Make only the first grid card clickable
            if (gridCards.length > 0) {
                const firstGridCard = gridCards[0];
                firstGridCard.style.cursor = 'pointer';
                firstGridCard.addEventListener('click', function (e) {
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();

                    const channelNameEl = this.querySelector('.grid-channel-name');
                    if (channelNameEl) {
                        const channelName = channelNameEl.textContent.trim();
                        openChannelChat(channelName, nodeName);
                    }
                }, true); // Use capture phase

                // Make other grid cards non-clickable
                for (let i = 1; i < gridCards.length; i++) {
                    gridCards[i].style.cursor = 'default';
                }
            }
        }

        // Setup channel handlers for all nodes
        setupChannelClickHandlers('work');
        setupChannelClickHandlers('family');
        setupChannelClickHandlers('hobbies');


        // Carousel Functionality
        function setupCarousel(carouselId) {
            const carousel = document.getElementById(carouselId);
            if (!carousel) return;

            const indicators = document.querySelectorAll(`[data-carousel="${carouselId.replace('carousel', '').toLowerCase()}"]`);

            carousel.addEventListener('scroll', () => {
                const scrollLeft = carousel.scrollLeft;
                const cardWidth = carousel.offsetWidth;
                const currentIndex = Math.round(scrollLeft / cardWidth);

                indicators.forEach((indicator, index) => {
                    if (index === currentIndex) {
                        indicator.classList.add('active');
                    } else {
                        indicator.classList.remove('active');
                    }
                });
            });

            // Indicator click navigation
            indicators.forEach(indicator => {
                indicator.addEventListener('click', () => {
                    const index = parseInt(indicator.getAttribute('data-index'));
                    const cardWidth = carousel.offsetWidth;
                    carousel.scrollTo({
                        left: cardWidth * index,
                        behavior: 'smooth'
                    });
                });
            });
        }

        // Setup carousels for all nodes
        setupCarousel('carouselWork');
        setupCarousel('carouselFamily');
        setupCarousel('carouselHobbies');

        // Tab Switching Functionality
        function setupTabs(nodeName) {
            const tabs = document.querySelectorAll(`[data-node="${nodeName}"].node-tab`);
            const indicator = document.getElementById(`tabIndicator${capitalize(nodeName)}`);

            tabs.forEach((tab, index) => {
                tab.addEventListener('click', () => {
                    const tabType = tab.getAttribute('data-tab');

                    toggleActive(tabs, tab);

                    const tabWidth = 100 / tabs.length;
                    indicator.style.left = `${tabWidth * index}%`;
                    indicator.style.width = `${tabWidth}%`;

                    const contentIds = {
                        'all': `${nodeName}TabAll`,
                        'chat': `${nodeName}TabChat`,
                        'voice': `${nodeName}TabVoice`,
                        'resources': `${nodeName}TabResources`
                    };

                    switchContent(contentIds, contentIds[tabType]);
                });
            });
        }

        // Setup tabs for all nodes
        setupTabs('work');
        setupTabs('family');
        setupTabs('hobbies');

        // Touch swipe for tab switching
        function setupTabSwipe(nodeName) {
            const container = document.querySelector(`#nodeInterface${capitalize(nodeName)} .tab-content-container`);
            if (!container) return;

            let touchStartX = 0;
            let touchEndX = 0;

            container.addEventListener('touchstart', (e) => {
                touchStartX = e.changedTouches[0].screenX;
            });

            container.addEventListener('touchend', (e) => {
                touchEndX = e.changedTouches[0].screenX;
                handleTabSwipe(nodeName);
            });

            function handleTabSwipe(node) {
                const tabs = document.querySelectorAll(`[data-node="${node}"].node-tab`);
                const activeTabs = Array.from(tabs);
                const currentIndex = activeTabs.findIndex(tab => tab.classList.contains('active'));

                if (touchEndX < touchStartX - 50 && currentIndex < tabs.length - 1) {
                    // Swipe left - next tab
                    tabs[currentIndex + 1].click();
                }

                if (touchEndX > touchStartX + 50 && currentIndex > 0) {
                    // Swipe right - previous tab
                    tabs[currentIndex - 1].click();
                }
            }
        }

        setupTabSwipe('work');
        setupTabSwipe('family');
        setupTabSwipe('hobbies');

        // View Toggle Functionality for Chat Tab
        document.querySelectorAll('.view-toggle-btn').forEach(btn => {
            btn.addEventListener('click', function () {
                const view = this.getAttribute('data-view');
                const node = this.getAttribute('data-node');

                toggleActive(this.parentElement.querySelectorAll('.view-toggle-btn'), this);

                const listView = document.getElementById(`${node}ListView`);
                const gridView = document.getElementById(`${node}GridView`);

                if (view === 'list') {
                    if (listView) listView.style.display = 'block';
                    if (gridView) gridView.style.display = 'none';
                } else if (view === 'grid') {
                    if (listView) listView.style.display = 'none';
                    if (gridView) gridView.style.display = 'grid';
                }
            });
        });

        // Resource Sub-Tabs Functionality
        document.querySelectorAll('.resource-sub-tab').forEach(btn => {
            btn.addEventListener('click', function () {
                const resourceTab = this.getAttribute('data-resource-tab');
                const node = this.getAttribute('data-node');

                toggleActive(this.parentElement.querySelectorAll('.resource-sub-tab'), this);

                const contentIds = {
                    'media': `${node}MediaContent`,
                    'files': `${node}FilesContent`,
                    'links': `${node}LinksContent`,
                    'audios': `${node}AudiosContent`
                };

                // Resource content uses style.display, not classList
                Object.values(contentIds).forEach(id => {
                    const content = document.getElementById(id);
                    if (content) content.style.display = 'none';
                });

                const activeContent = document.getElementById(contentIds[resourceTab]);
                if (activeContent) activeContent.style.display = 'block';
            });
        });

        // Node Creation Modal Functionality
        const modal = document.getElementById('createNodeModal');
        const createNodeBtn = document.getElementById('addNodeBtn');
        const closeModalBtn = document.getElementById('closeModal');
        const cancelBtn = document.getElementById('cancelBtn');
        const createBtn = document.getElementById('createBtn');
        const nodeName = document.getElementById('nodeName');
        const nodeDescription = document.getElementById('nodeDescription');

        // Open modal when + button is clicked
        if (createNodeBtn) {
            createNodeBtn.addEventListener('click', () => {
                modal.classList.add('active');
            });
        }

        // Close modal
        function closeModal() {
            modal.classList.remove('active');
        }

        closeModalBtn.addEventListener('click', closeModal);
        cancelBtn.addEventListener('click', closeModal);
        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeModal();
        });

        // Character counting
        nodeName.addEventListener('input', (e) => {
            document.getElementById('nameCount').textContent = e.target.value.length;
            document.getElementById('shareCardName').textContent = e.target.value || 'My New Node';
        });

        nodeDescription.addEventListener('input', (e) => {
            document.getElementById('descCount').textContent = e.target.value.length;
        });

        // Theme selection
        document.querySelectorAll('.theme-option').forEach(option => {
            option.addEventListener('click', function () {
                toggleActive(document.querySelectorAll('.theme-option'), this);
            });
        });

        // Invite tabs
        document.querySelectorAll('.invite-tab').forEach(tab => {
            tab.addEventListener('click', function () {
                const inviteType = this.getAttribute('data-invite');
                toggleActive(document.querySelectorAll('.invite-tab'), this);
                toggleActive(document.querySelectorAll('.invite-content'), document.getElementById(`${inviteType}Invite`));
            });
        });

        // Contact selection
        let selectedContacts = 0;
        document.querySelectorAll('.contact-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', function () {
                selectedContacts = document.querySelectorAll('.contact-checkbox:checked').length;
                document.getElementById('selectedCount').textContent = `${selectedContacts} selected`;
            });
        });

        // Copy invite link
        document.getElementById('copyLinkBtn').addEventListener('click', function () {
            const linkInput = document.getElementById('inviteLink');
            linkInput.select();
            document.execCommand('copy');

            this.textContent = 'Copied!';
            this.classList.add('copied');

            setTimeout(() => {
                this.textContent = 'Copy';
                this.classList.remove('copied');
            }, 2000);
        });

        // Share card tabs
        document.querySelectorAll('.share-card-tab').forEach(tab => {
            tab.addEventListener('click', function () {
                const cardType = this.getAttribute('data-card');
                toggleActive(document.querySelectorAll('.share-card-tab'), this);

                const preview = document.getElementById('shareCardPreview');
                if (cardType === 'instagram') {
                    preview.classList.add('instagram');
                } else {
                    preview.classList.remove('instagram');
                }
            });
        });

        // Create node button
        createBtn.addEventListener('click', function () {
            const name = nodeName.value.trim();

            if (!name) {
                alert('Please enter a node name');
                return;
            }

            // Mock success
            alert(`Node "${name}" created successfully!\n\nNote: This is a prototype. The node won't actually appear in the sidebar.`);
            closeModal();

            // Reset form
            nodeName.value = '';
            nodeDescription.value = '';
            document.getElementById('nameCount').textContent = '0';
            document.getElementById('descCount').textContent = '0';
            document.querySelectorAll('.contact-checkbox').forEach(cb => cb.checked = false);
            selectedContacts = 0;
            document.getElementById('selectedCount').textContent = '0 selected';
        });

        // Member Directory System
        const mockMembers = [
            { id: 1, name: "Sarah Chen", initials: "SC", role: "admin", online: true, avatar: "avatar-blue", joined: "Nov 15, 2024", stats: { messages: 1234, voice: 45 }, status: "Online", channels: ["Project Management", "Development"], content: { files: 23, media: 156, links: 89 } },
            { id: 2, name: "Mike Johnson", initials: "MJ", role: "admin", online: true, avatar: "avatar-green", joined: "Nov 20, 2024", stats: { messages: 987, voice: 32 }, status: "Online", channels: ["Project Management", "Design"], content: { files: 18, media: 92, links: 45 } },
            { id: 3, name: "Alex Kim", initials: "AK", role: "moderator", online: true, avatar: "avatar-orange", joined: "Dec 1, 2024", stats: { messages: 654, voice: 28 }, status: "Online", channels: ["Development", "DevOps"], content: { files: 12, media: 67, links: 34 } },
            { id: 4, name: "Emma Davis", initials: "ED", role: "moderator", online: true, avatar: "avatar-purple", joined: "Dec 3, 2024", stats: { messages: 543, voice: 19 }, status: "In voice room", channels: ["Design", "Project Management"], content: { files: 9, media: 45, links: 28 } },
            { id: 5, name: "Tom Wilson", initials: "TW", role: "moderator", online: false, avatar: "avatar-red", joined: "Dec 5, 2024", stats: { messages: 432, voice: 15 }, status: "Idle", channels: ["Development", "Frontend"], content: { files: 7, media: 34, links: 19 } },
            { id: 6, name: "Lisa Martinez", initials: "LM", role: "moderator", online: false, avatar: "avatar-teal", joined: "Dec 7, 2024", stats: { messages: 321, voice: 12 }, status: "Idle", channels: ["DevOps", "Backend"], content: { files: 5, media: 23, links: 15 } },
            { id: 7, name: "John Doe", initials: "JD", role: "member", online: true, avatar: "avatar-blue", joined: "Dec 8, 2024", stats: { messages: 234, voice: 8 }, status: "Online", channels: ["Project Management"], content: { files: 4, media: 18, links: 12 } },
            { id: 8, name: "Jane Smith", initials: "JS", role: "member", online: true, avatar: "avatar-green", joined: "Dec 9, 2024", stats: { messages: 198, voice: 6 }, status: "Online", channels: ["Development"], content: { files: 3, media: 15, links: 9 } },
            { id: 9, name: "Robert Brown", initials: "RB", role: "member", online: true, avatar: "avatar-orange", joined: "Dec 10, 2024", stats: { messages: 176, voice: 5 }, status: "Online", channels: ["Design"], content: { files: 2, media: 12, links: 7 } },
            { id: 10, name: "Maria Garcia", initials: "MG", role: "member", online: true, avatar: "avatar-purple", joined: "Dec 11, 2024", stats: { messages: 154, voice: 4 }, status: "Online", channels: ["Frontend"], content: { files: 2, media: 10, links: 6 } },
            { id: 11, name: "David Lee", initials: "DL", role: "member", online: true, avatar: "avatar-red", joined: "Dec 11, 2024", stats: { messages: 132, voice: 3 }, status: "Online", channels: ["Backend"], content: { files: 1, media: 8, links: 5 } },
            { id: 12, name: "Jennifer White", initials: "JW", role: "member", online: true, avatar: "avatar-teal", joined: "Dec 12, 2024", stats: { messages: 110, voice: 2 }, status: "Online", channels: ["DevOps"], content: { files: 1, media: 6, links: 4 } },
            { id: 13, name: "Chris Harris", initials: "CH", role: "member", online: true, avatar: "avatar-blue", joined: "Dec 12, 2024", stats: { messages: 98, voice: 2 }, status: "Online", channels: ["Project Management"], content: { files: 1, media: 5, links: 3 } },
            { id: 14, name: "Amanda Miller", initials: "AM", role: "member", online: true, avatar: "avatar-green", joined: "Dec 12, 2024", stats: { messages: 87, voice: 1 }, status: "Online", channels: ["Development"], content: { files: 0, media: 4, links: 2 } },
            { id: 15, name: "Kevin Taylor", initials: "KT", role: "member", online: false, avatar: "avatar-orange", joined: "Dec 12, 2024", stats: { messages: 76, voice: 1 }, status: "Idle", channels: ["Design"], content: { files: 0, media: 3, links: 2 } },
            { id: 16, name: "Sophia Anderson", initials: "SA", role: "member", online: false, avatar: "avatar-purple", joined: "Dec 12, 2024", stats: { messages: 65, voice: 0 }, status: "Idle", channels: ["Frontend"], content: { files: 0, media: 2, links: 1 } },
            { id: 17, name: "Brian Thomas", initials: "BT", role: "member", online: false, avatar: "avatar-red", joined: "Dec 12, 2024", stats: { messages: 54, voice: 0 }, status: "Idle", channels: ["Backend"], content: { files: 0, media: 1, links: 1 } },
            { id: 18, name: "Olivia Jackson", initials: "OJ", role: "member", online: false, avatar: "avatar-teal", joined: "Dec 12, 2024", stats: { messages: 43, voice: 0 }, status: "Idle", channels: ["DevOps"], content: { files: 0, media: 1, links: 0 } },
            { id: 19, name: "James Martin", initials: "JM", role: "member", online: false, avatar: "avatar-blue", joined: "Dec 12, 2024", stats: { messages: 32, voice: 0 }, status: "Idle", channels: ["Project Management"], content: { files: 0, media: 0, links: 1 } },
            { id: 20, name: "Emily Harris", initials: "EH", role: "member", online: false, avatar: "avatar-green", joined: "Dec 12, 2024", stats: { messages: 21, voice: 0 }, status: "Idle", channels: ["Development"], content: { files: 0, media: 0, links: 0 } },
            { id: 21, name: "Daniel Garcia", initials: "DG", role: "member", online: false, avatar: "avatar-orange", joined: "Dec 12, 2024", stats: { messages: 15, voice: 0 }, status: "Idle", channels: ["Design"], content: { files: 0, media: 0, links: 0 } },
            { id: 22, name: "Nicole Rodriguez", initials: "NR", role: "member", online: false, avatar: "avatar-purple", joined: "Dec 12, 2024", stats: { messages: 10, voice: 0 }, status: "Idle", channels: ["Frontend"], content: { files: 0, media: 0, links: 0 } },
            { id: 23, name: "Matthew Wilson", initials: "MW", role: "member", online: false, avatar: "avatar-red", joined: "Dec 12, 2024", stats: { messages: 5, voice: 0 }, status: "Idle", channels: ["Backend"], content: { files: 0, media: 0, links: 0 } },
            { id: 24, name: "Ashley Lopez", initials: "AL", role: "member", online: false, avatar: "avatar-teal", joined: "Dec 12, 2024", stats: { messages: 2, voice: 0 }, status: "Idle", channels: ["DevOps"], content: { files: 0, media: 0, links: 0 } }
        ];

        let currentFilter = 'all';
        let searchQuery = '';

        // Panel management
        const membersPanel = document.getElementById('membersPanel');
        const membersPanelOverlay = document.getElementById('membersPanelOverlay');
        const workMembersBtn = document.getElementById('workMembersBtn');
        const hobbiesMembersBtn = document.getElementById('hobbiesMembersBtn');
        const closeMembersBtn = document.getElementById('closeMembersPanel');

        function openMembersPanel() {
            membersPanel.classList.add('active');
            membersPanelOverlay.classList.add('active');
            renderMembersList();
        }

        function closeMembersPanel() {
            membersPanel.classList.remove('active');
            membersPanelOverlay.classList.remove('active');
        }

        if (workMembersBtn) {
            workMembersBtn.addEventListener('click', openMembersPanel);
        }

        if (hobbiesMembersBtn) {
            hobbiesMembersBtn.addEventListener('click', openMembersPanel);
        }

        closeMembersBtn.addEventListener('click', closeMembersPanel);
        membersPanelOverlay.addEventListener('click', closeMembersPanel);

        // Filter and search
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function () {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentFilter = this.getAttribute('data-filter');
                renderMembersList();
            });
        });

        document.getElementById('memberSearch').addEventListener('input', function (e) {
            searchQuery = e.target.value.toLowerCase();
            renderMembersList();
        });

        // Render members list
        function renderMembersList() {
            const membersList = document.getElementById('membersList');

            // Detect which node is active
            const isCanonNode = document.getElementById('hobbiesMembersBtn')?.closest('.node-interface')?.classList.contains('active');

            // Create a modified members array for Canon R Series Community
            const displayMembers = mockMembers.map(member => {
                // Change Sarah Chen's role to 'member' for Canon R Series Community
                if (member.id === 1 && isCanonNode) {
                    return { ...member, role: 'member' };
                }
                return member;
            });

            // Apply search and filter
            let filtered = displayMembers.filter(m => {
                const matchesSearch = m.name.toLowerCase().includes(searchQuery.toLowerCase());
                const matchesFilter = currentFilter === 'all' || m.role === currentFilter;
                return matchesSearch && matchesFilter;
            });

            // Sort by role priority, then by online status, then by name
            filtered.sort((a, b) => {
                const roleOrder = { admin: 0, moderator: 1, member: 2 };
                if (roleOrder[a.role] !== roleOrder[b.role]) {
                    return roleOrder[a.role] - roleOrder[b.role];
                }
                if (a.online !== b.online) {
                    return b.online - a.online;
                }
                return a.name.localeCompare(b.name);
            });

            // Group by role
            const grouped = {
                admin: filtered.filter(m => m.role === 'admin'),
                moderator: filtered.filter(m => m.role === 'moderator'),
                member: filtered.filter(m => m.role === 'member')
            };

            let html = '';
            if (grouped.admin.length > 0) {
                html += `<div class="member-section-header">ADMINS (${grouped.admin.length})</div>`;
                grouped.admin.forEach(m => html += renderMemberRow(m));
            }
            if (grouped.moderator.length > 0) {
                html += `<div class="member-section-header">MODERATORS (${grouped.moderator.length})</div>`;
                grouped.moderator.forEach(m => html += renderMemberRow(m));
            }
            if (grouped.member.length > 0) {
                html += `<div class="member-section-header">MEMBERS (${grouped.member.length})</div>`;
                grouped.member.forEach(m => html += renderMemberRow(m));
            }

            membersList.innerHTML = html;

            // Add click listeners
            document.querySelectorAll('.member-row').forEach(row => {
                row.addEventListener('click', function () {
                    const memberId = parseInt(this.getAttribute('data-member-id'));
                    openMemberProfile(memberId);
                });
            });
        }

        function renderMemberRow(member) {
            // Detect which node is active by checking which members button was clicked
            const isCanonNode = document.getElementById('hobbiesMembersBtn')?.closest('.node-interface')?.classList.contains('active');

            // For Canon R Series Community, show Sarah Chen (id 1) as member instead of admin
            let displayRole = member.role;
            if (member.id === 1 && isCanonNode) {
                displayRole = 'member';
            }

            const roleClass = displayRole === 'admin' ? 'admin' : displayRole === 'moderator' ? 'moderator' : '';
            const roleLabel = displayRole.charAt(0).toUpperCase() + displayRole.slice(1);
            // Add "(me)" to Sarah Chen (id 1)
            const displayName = member.id === 1 ? `${member.name} (me)` : member.name;
            return `
                <div class="member-row" data-member-id="${member.id}" data-role="${displayRole}">
                    <div class="member-avatar ${member.avatar}">${member.initials}<div class="presence-indicator ${member.online ? 'online' : 'offline'}"></div></div>
                    <div class="member-info">
                        <div class="member-name">${displayName}</div>
                        <div class="member-role-label ${roleClass}">${roleLabel}</div>
                    </div>
                </div>
            `;
        }

        // Profile sheet
        const profileSheetOverlay = document.getElementById('profileSheetOverlay');
        const profileSheet = document.getElementById('profileSheet');

        function openMemberProfile(memberId) {
            // Allow Sarah Chen (1), Mike Johnson (2), and Amanda Miller (14)
            if (memberId !== 1 && memberId !== 2 && memberId !== 14) {
                return; // Do nothing for other members
            }

            const member = mockMembers.find(m => m.id === memberId);
            if (!member) return;

            // Determine current node based on active node interface
            const currentNode = document.querySelector('.node-interface.active');
            const isAstraDynamics = currentNode && currentNode.id === 'nodeInterfaceWork';
            const isCanonNode = currentNode && currentNode.id === 'nodeInterfaceHobbies';

            // Adjust Sarah Chen's role for Canon R Series Community
            let displayRole = member.role;
            if (member.id === 1 && isCanonNode) {
                displayRole = 'member';
            }

            // Show admin controls only for Astra Dynamics node
            const isAdmin = displayRole === 'admin';
            const adminControls = (isAstraDynamics && !isAdmin) ? `
                <div class="admin-controls">
                    <button class="admin-control-btn" onclick="promoteUser(${member.id})">Promote</button>
                    <button class="admin-control-btn" onclick="manageRoles(${member.id}, '${member.name}')">Manage Roles</button>
                    <button class="admin-control-btn" onclick="muteUser(${member.id}, '${member.name}')">Mute</button>
                    <button class="admin-control-btn danger" onclick="removeUser(${member.id}, '${member.name}')">Remove</button>
                </div>
            ` : '';

            // Member-level actions for Canon R Series Community (normal member)
            const memberActions = (!isAstraDynamics && !isAdmin) ? `
                <div class="admin-controls">
                    <button class="admin-control-btn" onclick="reportMember(${member.id}, '${member.name}')">Report Member</button>
                    <button class="admin-control-btn" onclick="muteChannel('${member.name}')">Mute This Channel</button>
                    <button class="admin-control-btn danger" onclick="leaveNode()">Leave Node</button>
                </div>
            ` : '';

            const roleClass = displayRole === 'admin' ? 'role-admin' : displayRole === 'moderator' ? 'role-moderator' : 'role-member';
            const roleLabel = displayRole.charAt(0).toUpperCase() + displayRole.slice(1);

            profileSheet.innerHTML = `
                <div class="profile-header">
                    <div class="profile-avatar ${member.avatar}">${member.initials}</div>
                    <div class="profile-name">${member.name}</div>
                    <div class="profile-role-badge ${roleClass}">${roleLabel}</div>
                </div>
                <div class="profile-body">
                    <div class="profile-section">
                        <div class="profile-section-title">Role & Authority</div>
                        <div class="profile-stat-row">
                            <span class="profile-stat-label">Role:</span>
                            <span class="profile-stat-value">${roleLabel}</span>
                        </div>
                        ${adminControls}
                        ${memberActions}
                    </div>
                    <div class="profile-section">
                        <div class="profile-section-title">Node Identity</div>
                        <div class="profile-stat-row">
                            <span class="profile-stat-label">Joined:</span>
                            <span class="profile-stat-value">${member.joined}</span>
                        </div>
                        <div class="profile-stat-row">
                            <span class="profile-stat-label">Messages:</span>
                            <span class="profile-stat-value">${member.stats.messages}</span>
                        </div>
                        <div class="profile-stat-row">
                            <span class="profile-stat-label">Voice calls:</span>
                            <span class="profile-stat-value">${member.stats.voice}</span>
                        </div>
                        <div class="profile-stat-row">
                            <span class="profile-stat-label">Status:</span>
                            <span class="profile-stat-value">${member.status}</span>
                        </div>
                    </div>
                    <div class="profile-section">
                        <div class="profile-section-title">Channels</div>
                        <div class="profile-channels-list">
                            ${member.channels.map(ch => `<div class="profile-channel-item" onclick="alert('Navigate to ${ch}')">${ch}</div>`).join('')}
                        </div>
                    </div>
                    <div class="profile-section">
                        <div class="profile-section-title">Shared Content</div>
                        <div class="profile-content-grid">
                            <div class="profile-content-item" onclick="alert('Show files from ${member.name}')">
                                <div class="profile-content-count">${member.content.files}</div>
                                <div class="profile-content-label">Files</div>
                            </div>
                            <div class="profile-content-item" onclick="alert('Show media from ${member.name}')">
                                <div class="profile-content-count">${member.content.media}</div>
                                <div class="profile-content-label">Media</div>
                            </div>
                            <div class="profile-content-item" onclick="alert('Show links from ${member.name}')">
                                <div class="profile-content-count">${member.content.links}</div>
                                <div class="profile-content-label">Links</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="profile-actions">
                    <button class="action-button action-button-primary" onclick="sendMessage('${member.name}')">Message</button>
                    <button class="action-button action-button-secondary" onclick="mentionUser('${member.name}')">Mention</button>
                    <button class="action-button action-button-secondary" onclick="inviteToVoice('${member.name}')">Invite</button>
                </div>
                <div class="profile-actions">
                    <button class="action-button action-button-secondary" onclick="closeMemberProfile()">Close</button>
                </div>
            `;

            profileSheetOverlay.classList.add('active');
        }

        function closeMemberProfile() {
            profileSheetOverlay.classList.remove('active');
        }

        profileSheetOverlay.addEventListener('click', function (e) {
            if (e.target === profileSheetOverlay) {
                closeMemberProfile();
            }
        });

        // Interaction functions
        function sendMessage(name) {
            alert(`Opening chat with ${name}...\\n\\nNote: This is a prototype.`);
        }

        function mentionUser(name) {
            alert(`Mentioning @${name}...\\n\\nNote: This is a prototype.`);
        }

        function inviteToVoice(name) {
            alert(`Inviting ${name} to voice room...\\n\\nNote: This is a prototype.`);
        }

        // Admin functions (partially functional with confirmation)
        async function promoteUser(memberId) {
            const member = mockMembers.find(m => m.id === memberId);
            const confirm = await customAlert.confirm(
                `Promote ${member.name} to Moderator?\n\nNote: This is a prototype. The change won't persist.`,
                'Promote User',
                { confirmText: 'PROMOTE' }
            );
            if (confirm) {
                customAlert.alert(` ${member.name} has been promoted to Moderator!`);
                closeMemberProfile();
            }
        }

        async function manageRoles(memberId, name) {
            await customAlert.alert(`Managing roles for ${name}...\n\n(Role management modal would open here)`, 'Manage Roles');
        }

        async function removeUser(memberId, name) {
            const confirm = await customAlert.confirm(
                `Remove ${name} from this node?\n\nThis action cannot be undone.\n\nNote: This is a prototype.`,
                'Remove Member',
                { confirmText: 'REMOVE', isDestructive: true }
            );
            if (confirm) {
                customAlert.alert(`${name} has been removed.`);
                closeMemberProfile();
            }
        }

        async function muteUser(memberId, name) {
            const confirm = await customAlert.confirm(
                `Mute ${name} for 24 hours?`,
                'Mute User',
                { confirmText: 'MUTE', isDestructive: true }
            );
            if (confirm) {
                customAlert.alert(`${name} has been muted.`);
                closeMemberProfile();
            }
        }

        // Member-level functions for non-admin nodes
        async function reportMember(memberId, name) {
            const confirm = await customAlert.confirm(
                `Report ${name} to node administrators?\n\nPlease specify the reason:\n Spam\n Harassment\n Inappropriate content`,
                'Report Member',
                { confirmText: 'REPORT', isDestructive: true }
            );
            if (confirm) {
                customAlert.alert(` ${name} has been reported to administrators.`);
                closeMemberProfile();
            }
        }

        async function muteChannel(channelName) {
            // channelName might be undefined if called without args, so handle that
            const name = channelName || 'this channel';
            const confirm = await customAlert.confirm(
                `Mute notifications for ${name}?\n\nYou can unmute it later from settings.`,
                'Mute Channel',
                { confirmText: 'MUTE', isDestructive: true }
            );
            if (confirm) {
                customAlert.alert(` Notifications have been muted.`);
                // Only close profile if open (check logic if needed, or just let it stay)
                // The previous code didn't check if profile was open but was called from there.
            }
        }

        async function leaveNode() {
            const confirm = await customAlert.confirm(
                `Leave this node?\n\nYou can rejoin later with an invite link.`,
                'Leave Node',
                { confirmText: 'LEAVE', isDestructive: true }
            );
            if (confirm) {
                customAlert.alert(` You have left the node.`);
                closeMemberProfile();
            }
        }

        // Node-level Admin Functions (for Astra Dynamics)
        async function showAdminMenu() {
            const options = [
                "1. Change Node Name",
                "2. Manage Channels",
                "3. Invite Members",
                "4. Manage Roles",
                "5. Delete/Archive Node",
                "6. Cancel"
            ];

            const choice = await customAlert.prompt("Admin Settings - Select an option:\n\n" + options.join("\n"), "", "Admin Menu");

            if (!choice) return;

            const num = parseInt(choice);

            switch (num) {
                case 1:
                    await changeNodeName();
                    break;
                case 2:
                    await manageChannels();
                    break;
                case 3:
                    await inviteMembers();
                    break;
                case 4:
                    await manageNodeRoles();
                    break;
                case 5:
                    await deleteOrArchiveNode();
                    break;
                default:
                    return;
            }
        }

        async function changeNodeName() {
            const newName = await customAlert.prompt("Enter new node name:", "Astra Dynamics", "Rename Node");
            if (newName && newName.trim()) {
                await customAlert.alert(` Node name changed to: "${newName}"\n\nNote: This is a prototype. Refresh to revert.`, "Success");
            }
        }

        async function manageChannels() {
            const action = await customAlert.confirm("Manage Channels:\n\n Create new channel\n Edit existing channels\n Set permissions\n Archive channels\n\nNote: This is a prototype.", "Channels");
            if (action) {
                await customAlert.alert(` Channel management panel would open here.`, "Info");
            }
        }

        async function inviteMembers() {
            const method = await customAlert.confirm("Invite Members:\n\nClick OK for Invite Link\nClick Cancel for QR Code\n\nNote: This is a prototype.", "Invite");
            if (method) {
                await customAlert.alert(` Invite link copied to clipboard:\nhttps://t.me/astra_dynamics\n\nNote: This is a prototype.`, "Link Copied");
            } else {
                await customAlert.alert(` QR Code displayed for node invitation.\n\nNote: This is a prototype.`, "QR Code");
            }
        }

        async function manageNodeRoles() {
            await customAlert.alert(`Role Management:\n\n Admin\n Moderator\n Member\n Guest\n\nAssign permissions and manage role hierarchy.\n\nNote: This is a prototype.`, "Roles");
        }

        async function deleteOrArchiveNode() {
            const action = await customAlert.confirm(" WARNING\n\nDelete or Archive Node?\n\nClick OK to DELETE (permanent)\nClick Cancel to ARCHIVE\n\nNote: This is a prototype.", "Danger Zone");
            if (action) {
                const confirmed = await customAlert.confirm(" FINAL CONFIRMATION\n\nThis will PERMANENTLY DELETE:\n All channels\n All messages\n All files\n All members\n\nThis CANNOT BE UNDONE.\n\nAre you absolutely sure?", "Delete Node");
                if (confirmed) {
                    await customAlert.alert(` Node "Astra Dynamics" has been deleted.\n\nNote: This is a prototype. Refresh to restore.`, "Deleted");
                }
            } else {
                await customAlert.alert(` Node archived successfully.\n\nYou can restore it from Settings > Archived Nodes.\n\nNote: This is a prototype.`, "Archived");
            }
        }
    </script>

    <!-- Custom Alert Implementation -->
    <style>
        /* Custom Telegram Alert Styles */
        .custom-alert-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .custom-alert-overlay.active {
            display: flex;
            opacity: 1;
        }

        .custom-alert-box {
            background-color: var(--bg-primary);
            width: 280px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            transform: scale(0.9);
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex;
            flex-direction: column;
        }

        .custom-alert-overlay.active .custom-alert-box {
            transform: scale(1);
        }

        .custom-alert-content {
            padding: 20px 24px 12px;
        }

        .custom-alert-title {
            font-size: 19px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .custom-alert-message {
            font-size: 15px;
            color: var(--text-primary);
            line-height: 1.4;
        }

        .custom-alert-input {
            width: 100%;
            margin-top: 16px;
            padding: 10px;
            border: 1px solid var(--divider);
            border-radius: 4px;
            /* Slightly squarer than main inputs */
            font-size: 16px;
            color: var(--text-primary);
            background-color: var(--bg-primary);
            /* Blend with modal */
            outline: none;
            display: none;
            /* Hidden by default */
            border-bottom: 2px solid transparent;
            transition: border-color 0.2s;
        }

        .custom-alert-input:focus {
            border-bottom-color: var(--accent-color);
        }

        .custom-alert-buttons {
            display: flex;
            justify-content: flex-end;
            padding: 8px 12px 12px;
        }

        .custom-alert-btn {
            border: none;
            background: none;
            padding: 10px 16px;
            font-size: 15px;
            font-weight: 500;
            color: var(--accent-color);
            text-transform: uppercase;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.1s;
        }

        .custom-alert-btn:hover {
            background-color: var(--chat-hover);
        }

        .custom-alert-btn:active {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .custom-alert-btn.destructive {
            color: #ff3b30;
        }

        .custom-alert-btn.destructive:hover {
            background-color: rgba(255, 59, 48, 0.1);
        }
    </style>

    <div id="custom-alert" class="custom-alert-overlay">
        <div class="custom-alert-box">
            <div class="custom-alert-content">
                <div class="custom-alert-title">Notification</div>
                <div class="custom-alert-message"></div>
                <input type="text" class="custom-alert-input" id="custom-alert-input">
            </div>
            <div class="custom-alert-buttons">
                <button class="custom-alert-btn" id="custom-alert-cancel">Cancel</button>
                <button class="custom-alert-btn" id="custom-alert-ok">OK</button>
            </div>
        </div>
    </div>

    <script>
        // Custom Alert Logic with Promises
        const customAlert = {
            overlay: document.getElementById('custom-alert'),
            title: document.querySelector('.custom-alert-title'),
            message: document.querySelector('.custom-alert-message'),
            input: document.getElementById('custom-alert-input'),
            okBtn: document.getElementById('custom-alert-ok'),
            cancelBtn: document.getElementById('custom-alert-cancel'),

            // Helper to reset and show modal
            _showModal: function (title, msg, type = 'alert', defaultValue = '', options = {}) {
                return new Promise((resolve) => {
                    this.title.textContent = title;
                    this.message.innerHTML = msg.replace(/\n/g, '<br>');

                    // Reset Input
                    this.input.value = defaultValue;
                    this.input.style.display = type === 'prompt' ? 'block' : 'none';

                    // Reset Buttons
                    this.cancelBtn.style.display = (type === 'confirm' || type === 'prompt') ? 'block' : 'none';
                    this.okBtn.textContent = options.confirmText || 'OK';
                    this.cancelBtn.textContent = options.cancelText || 'Cancel';

                    // Handle Destructive Style
                    if (options.isDestructive) {
                        this.okBtn.classList.add('destructive');
                    } else {
                        this.okBtn.classList.remove('destructive');
                    }

                    this.overlay.classList.add('active');

                    if (type === 'prompt') {
                        setTimeout(() => this.input.focus(), 100);
                    }

                    const close = (value) => {
                        this.overlay.classList.remove('active');
                        this.okBtn.onclick = null;
                        this.cancelBtn.onclick = null;
                        this.input.onkeydown = null;
                        resolve(value);
                    };

                    this.okBtn.onclick = () => {
                        if (type === 'prompt') close(this.input.value);
                        else close(true);
                    };

                    this.cancelBtn.onclick = () => {
                        if (type === 'prompt') close(null);
                        else close(false);
                    };

                    // Enter key support for prompt/alert
                    if (type === 'prompt' || type === 'alert') {
                        this.input.onkeydown = (e) => {
                            if (e.key === 'Enter') {
                                this.okBtn.click();
                            }
                        };
                    }
                });
            },

            alert: function (msg, title = 'Notification') {
                return this._showModal(title, msg, 'alert');
            },

            confirm: function (msg, title = 'Confirmation', options = {}) {
                return this._showModal(title, msg, 'confirm', '', options);
            },

            prompt: function (msg, defaultValue = '', title = 'Input') {
                return this._showModal(title, msg, 'prompt', defaultValue);
            }
        };

        // Demo sequence on load to verify
        setTimeout(async () => {
            // Silent demo or console log to avoid blocking user flow immediately?
            // Keeping it simple as requested, just defining the API.
            console.log("Custom Alert System Ready");
        }, 1000);
    </script>

    <!-- Edit Identity Modal -->
    <div class="modal-overlay" id="editIdentityModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Edit Node Identity</div>
                <button class="close-btn" onclick="closeIdentityModal()">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Display Name (Node Specific)</label>
                    <input type="text" class="form-input" id="identityNameInput"
                        placeholder="How you appear in this node">
                </div>

                <div class="form-group">
                    <label class="form-label">Node Avatar</label>
                    <div style="display: flex; align-items: center; gap: 16px;">
                        <div class="identity-avatar" id="avatarPreview"
                            style="width: 60px; height: 60px; font-size: 24px;">
                            <span>SC</span>
                        </div>
                        <button class="btn btn-secondary"
                            onclick="document.getElementById('avatarUpload').click()">Change Avatar</button>
                        <input type="file" id="avatarUpload" hidden accept="image/*"
                            onchange="handleAvatarUpload(this)">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Bio / Status</label>
                    <textarea class="form-textarea" id="identityBioInput"
                        placeholder="Add a short bio for this node..."></textarea>
                </div>

                <div class="live-preview-container">
                    <div class="preview-label">Live Preview</div>
                    <div class="live-preview-box">
                        <div class="preview-message">
                            <div class="preview-avatar" id="livePreviewAvatar"><span>SC</span></div>
                            <div class="preview-bubble">
                                <div class="preview-header">
                                    <span class="preview-name" id="livePreviewName">Sarah Chen</span>
                                    <span class="preview-role" id="livePreviewRole">Member</span>
                                </div>
                                <div class="preview-text">Hello everyone! This is how I look in this node.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeIdentityModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveIdentity()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Add Event Modal -->
    <div class="modal-overlay" id="addEventModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Add Important Event</div>
                <button class="close-btn" onclick="closeEventModal()">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <!-- Event Type Selection -->
                <div class="form-group">
                    <label class="form-label">Event Type</label>
                    <div class="event-type-tabs">
                        <button class="event-type-tab active" data-type="poll" onclick="selectEventType('poll')">
                            <svg viewBox="0 0 24 24">
                                <path
                                    d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z" />
                            </svg>
                            Poll
                        </button>
                        <button class="event-type-tab" data-type="meeting" onclick="selectEventType('meeting')">
                            <svg viewBox="0 0 24 24">
                                <path
                                    d="M17 10H7v2h10v-2zm2-7h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z" />
                            </svg>
                            Meeting
                        </button>
                        <button class="event-type-tab" data-type="announcement"
                            onclick="selectEventType('announcement')">
                            <svg viewBox="0 0 24 24">
                                <path
                                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" />
                            </svg>
                            Announcement
                        </button>
                    </div>
                </div>

                <!-- Title -->
                <div class="form-group">
                    <label class="form-label">Event Title</label>
                    <input type="text" class="form-input" id="eventTitleInput" placeholder="Enter event title...">
                </div>

                <!-- Description -->
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" id="eventDescInput" placeholder="Describe your event..."></textarea>
                </div>

                <!-- Meeting-specific fields -->
                <div class="form-group event-field meeting-field" style="display: none;">
                    <label class="form-label">Date & Time</label>
                    <input type="datetime-local" class="form-input" id="eventDateTime">
                </div>

                <div class="form-group event-field meeting-field" style="display: none;">
                    <label class="form-label">Location / Link</label>
                    <input type="text" class="form-input" id="eventLocation" placeholder="Video call link or room name">
                </div>

                <!-- Poll-specific fields -->
                <div class="form-group event-field poll-field">
                    <label class="form-label">Poll Options</label>
                    <div id="pollOptionsContainer">
                        <div class="poll-option-input">
                            <input type="text" class="form-input" placeholder="Option 1">
                            <button class="remove-option-btn" onclick="removePollOption(this)"
                                style="display:none;"></button>
                        </div>
                        <div class="poll-option-input">
                            <input type="text" class="form-input" placeholder="Option 2">
                            <button class="remove-option-btn" onclick="removePollOption(this)"
                                style="display:none;"></button>
                        </div>
                    </div>
                    <button class="add-option-btn" onclick="addPollOption()">+ Add Option</button>
                </div>

                <!-- Live Preview -->
                <div class="live-preview-container">
                    <div class="preview-label">Preview</div>
                    <div class="event-preview-box" id="eventPreviewBox">
                        <div class="carousel-card-content">
                            <div class="carousel-card-header">
                                <svg class="carousel-card-icon" viewBox="0 0 24 24" id="previewEventIcon">
                                    <path
                                        d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z" />
                                </svg>
                                <span class="carousel-card-type" id="previewEventType">Poll</span>
                            </div>
                            <div class="carousel-card-title" id="previewEventTitle">Event Title</div>
                            <div class="carousel-card-description" id="previewEventDesc">Event description will appear
                                here...</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeEventModal()">Cancel</button>
                <button class="btn btn-primary" onclick="createEvent()">Create Event</button>
            </div>
        </div>
    </div>

    <script>
        // Node Identity State
        const nodeIdentities = {
            work: {
                name: "Sarah Chen",
                role: "Project Lead",
                avatar: "SC",
                bio: "Leading the project."
            },
            family: {
                name: "Sarah",
                role: "Member",
                avatar: "S",
                bio: "Family matters."
            },
            hobbies: {
                name: "Sarah Chen",
                role: "Member",
                avatar: "SC",
                bio: "Photography enthusiast."
            }
        };

        let currentNode = null;

        function openIdentityModal(nodeId) {
            currentNode = nodeId;
            const identity = nodeIdentities[nodeId];

            // Populate Fields
            document.getElementById('identityNameInput').value = identity.name;
            document.getElementById('identityBioInput').value = identity.bio || "";

            // Populate Preview
            updatePreview(identity);

            // Show Modal
            const modal = document.getElementById('editIdentityModal');
            modal.classList.add('active');
        }

        function closeIdentityModal() {
            document.getElementById('editIdentityModal').classList.remove('active');
            currentNode = null;
        }

        function updatePreview(identity) {
            document.getElementById('livePreviewName').textContent = identity.name;
            document.getElementById('livePreviewRole').textContent = identity.role;
            document.getElementById('avatarPreview').innerHTML = `<span>${identity.avatar}</span>`; // Simplified avatar
            document.getElementById('livePreviewAvatar').innerHTML = `<span>${identity.avatar}</span>`;

            // Colors?
            // Would normally update colors based on role here
        }

        // Live Inputs
        document.getElementById('identityNameInput').addEventListener('input', (e) => {
            if (currentNode) {
                document.getElementById('livePreviewName').textContent = e.target.value;
            }
        });

        function handleAvatarUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const imgHtml = `<img src="${e.target.result}" alt="Avatar">`;
                    document.getElementById('avatarPreview').innerHTML = imgHtml;
                    document.getElementById('livePreviewAvatar').innerHTML = imgHtml;
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function saveIdentity() {
            if (!currentNode) return;

            const newName = document.getElementById('identityNameInput').value;
            const newBio = document.getElementById('identityBioInput').value;

            // Update State
            nodeIdentities[currentNode].name = newName;
            nodeIdentities[currentNode].bio = newBio;

            // Header Element Update
            const headerName = document.getElementById(`headerName${capitalize(currentNode)}`);
            if (headerName) headerName.textContent = newName;

            // Handle avatar if changed (this part needs more robust logic for real app)
            const avatarContent = document.getElementById('avatarPreview').innerHTML;
            const headerAvatar = document.getElementById(`headerAvatar${capitalize(currentNode)}`);
            if (headerAvatar) headerAvatar.innerHTML = avatarContent;

            closeIdentityModal();
        }

        function capitalize(s) {
            return s.charAt(0).toUpperCase() + s.slice(1);
        }
    </script>
    <!-- AI Summary Modal -->
    <div class="modal-overlay" id="aiSummaryModal">
        <div class="modal-content" style="max-width: 440px;">
            <div class="modal-header">
                <div class="modal-title">Node AI Summary</div>
                <div style="cursor: pointer;" onclick="closeAiSummaryModal()">
                    <svg viewBox="0 0 24 24" style="width: 24px; height: 24px; fill: var(--text-secondary);">
                        <path
                            d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                    </svg>
                </div>
            </div>
            <div class="modal-body">
                <div class="summary-section">
                    <div class="summary-channel">design-channel</div>
                    <div class="summary-item">Alice needs feedback on wireframes by Friday</div>
                </div>
                <div class="summary-section">
                    <div class="summary-channel">general</div>
                    <div class="summary-item">Team meeting scheduled for Monday 10:00 AM</div>
                </div>
                <div class="summary-section">
                    <div class="summary-channel">marketing</div>
                    <div class="summary-item">Bob assigned campaign draft due Sunday</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeAiSummaryModal()">Done</button>
            </div>
        </div>
    </div>

    <script>
        function openAiSummaryModal() {
            const modal = document.getElementById('aiSummaryModal');
            modal.classList.add('active');
        }

        function closeAiSummaryModal() {
            const modal = document.getElementById('aiSummaryModal');
            modal.classList.remove('active');
        }

        function toggleHeaderLayout(nodeName) {
            const nodeInterface = document.getElementById(`nodeInterface${capitalize(nodeName)}`);
            if (nodeInterface) {
                nodeInterface.classList.toggle('header-collapsed');
            }
        }
    </script>
</body>

</html>